var mobile_version="3.3.2",QAppName="QuickCRM",unlocked=true,init_done=false,home_created=false,LastViewed=[],SugarSessionId="",RowsPerPage=20,RowsPerDashlet=5,IconsLabels=true,tmpIconsLabels=false,CurrentUserId="",CurrentProfileId="",CurrentUserRoles=[],ActivitiesCurrentOffset=0,ActivitiesNextOffset=0,ActivitiesPrevOffset=0,ForceLogin=false,HighlightedWIcon="background-color:#fae9c7",Highlighted="background:#fae9c7;",OptUpload=((!mobile_app||!iOS)&&!QCRM.OffLine&&window.File&&window.FileReader&&window.FileList&&typeof btoa==="function"?true:false),PagesCreated=false,edit_data={},AttachTo="",AttachToLnk="",Pref={},dbgOption=false,dbgval="",regFindField=new RegExp("^(.+){(.+)}(.+)$",""),AddFields=["street","postalcode","city","state","country"],ListsPages=["LastViewed","Activities","GS"],SearchPages=[],ViewPages=[],Qpattern=new RegExp('^(.+session":")("|[^"]+)(".+)$',""),Beans=[],SimpleBeans=[];QCRM.dashlets=[];QCRM.maxDashlets=8;QCRM.searchIcons=[];QCRM.createIcons=[];QCRM.PickUsers=false;if(typeof QCRM.ajaxHeader==="undefined"){QCRM.ajaxHeader=function(a){}}function QAjax(c,b,a){$.ajax({url:proxy_url,dataType:"json",async:(c!=="login"),data:{method:c,input_type:"JSON",response_type:"JSON",rest_data:b},type:"post",crossdomain:mobile_app,cache:false,error:function(d){a(null)},success:a})}function SugarQuery(e,b,d,c){function a(f){if(f!==null&&f.name==="Invalid Session ID"&&e!=="logout"){if(e!=="login"){if(c===undefined){c=1}else{c++}if(c>6){return}SugarQuery("login",'[{"password":"'+(mobile_app?$.md5(Qpwd):getCookie("SugarP"))+'","user_name":"'+(mobile_app?Quser_name:getCookie("username"))+'"},"",""]',function(g){b=b.replace(Qpattern,"$1")+SugarSessionId+b.replace(Qpattern,"$3");SugarQuery(e,b,d,c+1)},c)}else{d(f)}}else{if(f!==null&&e=="login"&&f.name_value_list!==undefined){getDateTimeFormats(f.name_value_list);SugarSessionId=f.id;CurrentUserId=f.name_value_list.user_id.value;if(mobile_edition==="Pro"||ForceCE){}}d(f)}}QAjax(e,b,a)}QCRM.get_available_modules=function(g){var d=localStorage.getItem("dis-"+ServerAddress+CurrentUserId),f=localStorage.getItem("acl-"+ServerAddress+CurrentUserId);function e(h){if(Beans[h]!==undefined){Beans[h].access="none"}}function c(h,i){if(Beans[h]!==undefined){Beans[h].acl=i}}function b(m,o){var k,h=o.length,j=Beans[m].acl;for(k=0;k<o.length;k++){var p=o[k],n=p.action;switch(n){case"edit":j[n]=j[n]&&p.access;break;case"list":case"view":j[n]=p.access;break;case"delete":j.del=j.del&&p.access;break;default:break}}return j}if(d===null||d===""||f===null||f===""){d=[];f=[];if(QCRM.OffLine){}else{SugarQuery("get_available_modules",'{"session":"'+SugarSessionId+'"'+(sugar_version>="6.3"?(',"filter":'+(sugar_version>="6.5"?'"all"':'"all"')):"")+"}",function(k){if(k&&k.modules){k=k.modules;var h,p,j=k.length,l=[];for(h in QCRM.beans){var i=QCRM.beans[h],o=false;if(typeof k[0]==="string"){if(k.indexOf(i)===-1){l.push(i);e(i)}else{n={edit:true,view:true,list:true,del:true};f.push({module:i,acls:n});c(i,n);break}}else{for(p=0;p<j;p++){var n;if(k[p].module_key===i){o=true;n=b(i,k[p].acls);f.push({module:i,acls:n});c(i,n);break}}if(!o){l.push(i);e(i)}}}localStorage.setItem("dis-"+ServerAddress+CurrentUserId,JSON.stringify(l));localStorage.setItem("acl-"+ServerAddress+CurrentUserId,JSON.stringify(f))}g()})}}else{var a;d=jQuery.parseJSON(d);for(a in d){e(d[a])}f=jQuery.parseJSON(f);for(a in f){c(f[a].module,f[a].acls)}g()}};QCRM.get_entry=function(a,c,b){if(QCRM.OffLine){}else{SugarQuery("get_entry",'{"session":"'+SugarSessionId+'","module_name":"'+a+'","id":"'+c+'","select_fields":"","link_name_to_fields_array":""}',b)}};QCRM.get_entry_list=function(e,d,a,c,g,b,f,h){if(QCRM.OffLine){}else{SugarQuery("get_entry_list",'{"session":"'+SugarSessionId+'","module_name":"'+e+'","query":"'+d+'","order_by":"'+f+'","offset":'+g+',"select_fields":'+a+',"link_name_to_fields_array":'+(c===""?'""':c)+',"max_results":'+b+',"deleted":0}',h)}};QCRM.get_S_entry_list=function(e,d,a,c,g,b,f,h){if(QCRM.OffLine){}else{SugarQuery("get_entry_list",'{"session":"'+SugarSessionId+'","module_name":"'+e+'","query":"'+d+'","order_by":"'+f+'","offset":'+g+',"select_fields":"","link_name_to_fields_array":'+(c===""?'""':c)+',"max_results":'+b+',"deleted":0}',h)}};QCRM.get_relationships=function(c,d,g,f,b,a,e){if(QCRM.OffLine){}else{SugarQuery("get_relationships",'{"session":"'+SugarSessionId+'","module_name":"'+c+'","module_id":"'+g+'","link_field_name":"'+f+'","related_module_query":"'+b+'","related_fields":'+a+',"related_module_link_name_to_fields_array":"","deleted":0}',e)}};QCRM.search_by_module=function(b,e,c,a,d){if(QCRM.OffLine){}else{SugarQuery("search_by_module",'{"session":"'+SugarSessionId+'","search_string":"'+e+'","modules":["'+b.join('","')+'"],"offset":'+c+',"max_results":'+a+"}",d)}};function enableButton(b,a){if(a){$("#"+b).removeClass("ui-disabled")}else{$("#"+b).addClass("ui-disabled")}}function CreateExtLink(c,d){var a=mobile_app&&!iOS&&navigator.app,b=$("<a/>",{href:(a?"#":c),rel:"external",target:"_blank",style:"text-decoration:none;color:#444;"+d});if(a){b.click(function(){navigator.app.loadUrl(c,{openExternal:true})})}return b}function CreateDownloadLink(e,d,g,c){var i=(e==="Notes")?g.file_mime_type.value:g.last_rev_mime_type.value,h=iOS?/.+(gif|png|jpg|jpeg|pdf)$/i:/.+(gif|png|jpg|jpeg)$/i,b=g.filename.value,j,a=i.match(h),f;if(a){j=i.replace(h,"$1").toLowerCase()}else{a=b.match(h);if(a){j=b.replace(h,"$1").toLowerCase();if(j==="pdf"){i="application/pdf"}else{i="image/"+j}}}if(a){f=$("<a/>",{href:"#DownloadPage",style:"text-decoration:none;color:#444;"+c});f.click(function(){var k=(e==="Notes")?"get_note_attachment":"get_document_revision";SugarQuery(k,'{"session":"'+SugarSessionId+'","id":"'+(e==="Notes"?d:g.document_revision_id.value)+'"}',function(l){var n=(e==="Notes")?l.note_attachment.file:l.document_revision.file,m=(j==="pdf")?"embedPDF":"embedIMG";$("#DownloadDiv").html('<embed  class="'+m+'" type="'+i+'" src="data:'+i+";base64,"+escape(n)+'"></embed>');$("#DownloadPageTitle").text(g.name.value)})})}else{f=CreateExtLink(ServerAddress+"index.php?entryPoint=download&id="+d+"&type="+e,c)}return f}function AddPhonePopup(d){var c=$('<ul id="Phone'+d+'L" data-role="listview" data-inset="true" data-theme="d"/>'),b='<a href="#'+d+'" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>',a=$('<div data-role="popup" data-corner="true" data-shadow="true" data-theme="d" id="Phone'+d+'"/>');a.append(b);a.append(c);$("#"+d).append(a)}function AddMapPopup(d){var c=$('<div id="Map'+d+'D"/>'),b='<a href="#'+d+'DetailsPage" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>',a=$('<div data-role="popup" data-corner="true" data-shadow="true" data-theme="d" id="Map'+d+'"/>');a.append(b);a.append(c);$("#"+d+"DetailsPage").append(a)}function QuickCRMAddDetailsPage(b){if(ViewPages.indexOf(b)!==-1){return}ViewPages=ViewPages.concat(b);var c=b+"DetailsPage",a="#Edit"+b;$("#"+c).live("pagecreate",function(){AddPhonePopup(b+"DetailsPage");if(Beans[b].HasAddress()){AddMapPopup(b)}var e=Beans[b].CustomLinks||Beans[b].Links;for(var i in e){var d=(Beans[b].CustomLinks&&Beans[b].CustomLinks[0]!==undefined)?e[i]:i;if(Beans[b].Links[d]!==undefined){var h=Beans[b].Links[d].module;if(sugar_app_list_strings.moduleList[h]!==undefined&&(Beans[h]===undefined||(Beans[h].Enabled()))){var g='<ul id="'+b+"DetailsPage"+d+'ListUl"  data-role="listview" data-split-theme="c" data-inset="true" />';$("#"+b+"Links").append(g)}}}});$("#"+c).live("pageshow",function(){Beans[b].ViewDetails()});$(a).live("pagecreate",function(){$(a+"Title").text(sugar_app_list_strings.moduleListSingular[b])})}function QuickCRMAddListPage(b){if(SearchPages.indexOf(b)!==-1){return}SearchPages=SearchPages.concat(b);ListsPages=ListsPages.concat(b);Beans[b].AddBtn=true;var a=Beans[b];$("#"+b+"ListPage").live("pagecreate",function(){AddPhonePopup(b+"ListPage")});$("#"+b+"ListPage").live("pageshow",function(){a.GetList(a.CurrentOffset)});$("#"+b+"Search").live("pagecreate",function(){$("#"+b+"SearchTitle").text(sugar_app_list_strings.moduleList[b]);$("#"+b+"DivMoreOptions").append("<p>"+RES_UNAVAILABLE+"</p>");if(!iOS){$("#"+b+"Search input[type=checkbox]").live("change",function(c){$("#"+b+"Search input[type=checkbox]").checkboxradio("refresh")})}});$("#"+b+"Search").live("pageshow",function(){LoadMyItems(b)})}function toDBConcatName(b,a){if(QCRM.OffLine){return"(IFNULL("+b+",'') || ' ' || "+a+")"}else{if(db_type==="mysql"){return"CONCAT(IFNULL("+b+",''),' ',"+a+")"}else{return"ISNULL("+b+",'')+' '+"+a}}}function cleanup_phone(a){return a.replace("(","").replace(")","").replace(/\s/g,"").replace(/-/g,"").replace(/\./g,"")}function create_input_form(j,c,k,i,h,e){var g=$("<div data-role='fieldcontain'"+(h?' data-mini="true"':"")+"/>"),b=i?"<em>* </em>":"",d="<label for='"+c+"'>"+b+k+"</label>",a=$("<input id='"+c+"' type='"+j+"'"+(e?" data-clear-btn='true'":"")+"/>");g.append(d);g.append(a);return g}function create_text_form(b,c,e,d,a){return create_input_form("text",b,c,e,d,(a===undefined||a))}function create_textarea_form(a,b,e,c){var d=$("<div data-role='fieldcontain'"+(c?' data-mini="true"':"")+"/>");d.append("<label for='"+a+"'>"+(e?"<em>* </em>":"")+b+"</label>");d.append("<textarea name='"+a+"' id='"+a+"'</textarea>");return d}function create_select(a,g,b,c){function e(j,i,h){j.append($("<option "+(b===i?' selected="selected"':"")+'value="'+i+'">'+h+"</option>"))}var f=(c==true?"data-mini='true' ":""),d=$("<select name='"+a+"' id='"+a+"' "+f+"data-theme='c'/>");if(g[""]!==undefined){e(d,"EMPTY",g[""])}$.each(g,function(i,h){if(i!==""){e(d,i,h)}});return d}function create_enum_form(b,i,j,g,e,h){if(h===undefined){h=false}var d=$("<div data-role='fieldcontain'"+(e?' data-mini="true"':"")+"/>"),a=g?"<em>* </em>":"",c="<label for='"+b+"' class='select'>"+a+i+"</label>";if(i!==""){d.append(c)}d.append(create_select(b,j,h));return d}function onChangeDateEnum(a){var b=$("#"+a+"E").val();if($("#"+a+"E").val()=="between"){$("#"+a+"FromTo").show()}else{$("#"+a+"FromTo").hide()}}function SavedSearchToggle(a){}function SavedSearchEnum(a){}function StartSearch(a){Beans[a].CurrentSearchValues=readSearchValues(a);Beans[a].CurrentSearchOrder=readSortOrderDropdown("SOrder"+a,a);SaveMyItems(a,$("#"+a+"MyItems").is(":checked"));$.mobile.changePage("#"+a+"ListPage")}function SaveSearch(a){SaveMyItems(a,$("#"+a+"MyItems").is(":checked"));updateSavedSearch(a,readSearchValues(a),readSortOrderDropdown("SOrder"+a,a));SavedSearchEnum(a)}function readSearchValues(c){var a=[],d=c+"DivMoreOptions";var b="Settings"+c+"Search";a.push({field:b,type:"txt",val:$("#"+b).val()});$("#"+d+" [type=checkbox]").each(function(f,e){var g=$(this).is(":checked");a.push({field:this.id,type:"chk",val:g})});$("#"+d+" input[type!=checkbox]").each(function(f,e){var h=$(this).val();if(this.name!==""&&h!==""&&this.name.substring(0,4)==="Pick"){var g=$(this).mobiscroll("getDate");if(g!==null&&e!==""){h=toDBDate(g)}}a.push({field:this.id,type:"txt",val:h})});$("#"+d+" select").each(function(f,e){var g=$(this).val();a.push({field:this.id,type:"sel",val:g})});return a}function clearSearchValues(a){var b=a+"DivMoreOptions";$("#Settings"+a+"Search").val("");$("#"+b+" [type=checkbox]").each(function(d,c){$(this).attr("checked",false).checkboxradio("refresh")});$("#"+b+" input[type!=checkbox]").each(function(d,c){if(this.name&&this.name.substring(0,4)==="Pick"){$(this).mobiscroll("setDate",new Date(),false)}else{$(this).val("")}});$("#"+b+" select").each(function(d,c){$("#"+this.id+' option[selected="selected"]').each(function(){$(this).removeAttr("selected")});$("#"+this.id+" option:first").attr("selected","selected");$(this).selectmenu("refresh")});ClearSavedSearch(a)}function loadSearchValues(b,a){for(field in a.fields){try{var e=a.fields[field],d=$("#"+e.field);if(e.type==="chk"){d.attr("checked",e.val).checkboxradio("refresh")}else{if(e.val!==""&&d.attr("name")!==undefined&&d.attr("name").substring(0,4)==="Pick"){d.mobiscroll("setDate",fromDBDate(e.val),true)}else{if(e.type==="sel"){d.val(e.val).selectmenu("refresh")}else{d.val(e.val)}}}}catch(c){}}$("#HSavedN"+b).attr("checked",(a.home!=="I"&&a.home!=="D")).checkboxradio("refresh");$("#HSavedI"+b).attr("checked",a.home==="I").checkboxradio("refresh");$("#HSavedD"+b).attr("checked",a.home==="D").checkboxradio("refresh")}function SaveSavedSearch(){localStorage.setItem(QuickCRMAddress+"SavedSearches",JSON.stringify(QCRM.SavedSearch))}function ClearSavedSearch(a){$("#"+a+"SaveAs").val("");$("#"+a+"ES").val(" ");$("#HSavedN"+a).attr("checked",true).checkboxradio("refresh");$("#HSavedI"+a).attr("checked",false).checkboxradio("refresh");$("#HSavedD"+a).attr("checked",false).checkboxradio("refresh");SavedSearchToggle(a)}function DelCurrentSavedSearch(b){var a=$("#"+b+"ES").val();if(a!==undefined&&a!==" "){ConfirmPopup(sugar_app_strings.NTC_DELETE_CONFIRMATION,function(){var c=QCRM.SavedSearch;for(var d in c){if(c[d]&&a===c[d].name&&b===c[d].module){if(c[d].home==="D"){updateDashlets()}QCRM.SavedSearch.splice(d,1);SavedSearchEnum(b);SaveSavedSearch();ClearSavedSearch(b);return}}},"")}}function createDashlets(){}function updateDashlets(){}function display1Dashlet(a,b){}function displayDashlets(){}function updateSavedSearch(a,f,b){var g=$("#"+a+"SaveAs").val();if(g!==""){var c=QCRM.SavedSearch;var e=false;for(var d in c){var k=c[d];if(k.module===a&&g===k.name){e=d;break}}var h=$("input[name='"+a+"HSavedS']:checked").val();if(e){QCRM.SavedSearch[e].fields=f;QCRM.SavedSearch[e].home=h;QCRM.SavedSearch[e].order=b}else{QCRM.SavedSearch.push({module:a,name:g,fields:f,home:h,order:b})}updateDashlets();SaveSavedSearch()}}function get_where(a,b){var d="",h="",j=false,c=QCRM.SavedSearch,k=Beans[a],n=k.table;var m=Beans[a].SearchFields,e=[];for(var g in b){e[b[g].field]={type:b[g].type,val:b[g].val}}j=e[a+"MyItems"].val;if(j){if(d!==""){d+=" and"}d+=" "+n+".assigned_user_id = '"+CurrentUserId+"'"}var i=e["Settings"+a+"Search"].val;if(i!==""){if(d!==""){d+=" and"}d+=" "+k.SearchName+" LIKE '%"+i.replace(/'/g,QCRM.OffLine?"&#039;":"''")+"%'"}if(Pref.FilterOldDate!==""&&Pref.FilterOld.indexOf(a)!==-1){if(d!==""){d+=" and"}d+=" "+n+".date_entered > '"+Pref.FilterOldDate+"'"}return d}function SaveMyItems(b,a){localStorage.setItem(b+"MyItems",(a?1:0))}function LoadMyItems(b){var a=localStorage.getItem(b+"MyItems");if(a==="1"){$("#"+b+"MyItems").attr("checked",true).checkboxradio("refresh")}else{$("#"+b+"MyItems").attr("checked",false).checkboxradio("refresh")}}function AlertPopup(a){a=HTMLDecode(a);if(mobile_app&&navigator.notification){}else{alert(a)}}function ConfirmPopup(a,c,b){a=HTMLDecode(a);if(mobile_app&&navigator.notification){}else{if(confirm(a)){c()}}}function getPhoneValues(h,p,d){var b=[],n=0;var k=Beans[d].PhoneFields,q=false;for(var m in k){if(h[k[m]]!==undefined&&h[k[m]].value!==""){if(q===false){q={module:d,name:Beans[d].DisplayTitle(h),records:[]}}n++;q.records.push({phone:h[k[m]].value,type:k[m]})}}if(q!==false){b.push(q)}if(p.length>0){for(var g=0;g<p.length;g++){var o=p[g],j=o.name,c=Beans[d].Links[j].module;k=Beans[c].PhoneFields;for(var a=0;a<o.records.length;a++){var i=o.records[a];if(i&&i.link_value){i=i.link_value;q=false;for(var m in k){var e=k[m];if(i[e]!==undefined&&i[e].value!==""){if(n<6){if(q===false){q={module:c,name:Beans[c].DisplayTitle(i),records:[]}}q.records.push({phone:i[k[m]].value,type:e})}}}}if(q!==false){b.push(q)}}}}return b}function OpenPhoneList(c,k,e,b,f){$(b+"L li").remove();var h=$(b+"L"),o;if(b==="#PhoneAccountsDetailsPage"){o=Beans.Accounts.CurrentId}else{if(k.account_id){o=k.account_id.value}}for(var n in c){var j=c[n],m=j.module;h.append($('<li data-theme="a"/>').append("<h4>"+j.name+"</h4>"));for(var a=0;a<j.records.length;a++){var i=j.records[a];var g=$("<a/>",{href:"tel:"+cleanup_phone(i.phone),rel:"external",style:"text-decoration:none;color:#444;",click:function(){$(b).popup("close");LogCall(e,k.id.value,o,f);return true}});g.append(display_label(m,i.type)+" "+i.phone);h.append($('<li data-theme="e" data-icon="phone"/>').append(g))}}h.listview("refresh")}function OpenMap(c,b,a){$("#Map"+b+"D").html('<iframe id="Map'+b+'I"+ src="http://maps.google.com/?q='+a+'&t=m&z=13&iwloc=near&output=embed" width="480" height="320" seamless></iframe>');setTimeout('$("#'+c+'").removeClass("ui-btn-active")',100)}function AjaxErr(){$.mobile.changePage("#LoginPage");$("#LoginLoading").html("Login failed. Please check permissions on custom/QuickCRM directory");if(mobile_app){$("#NeedHelpDiv").show()}}function MobileInit(i){function c(){QCRM.get_available_modules(function(){var l="#HomePage";if(i!==undefined){l=i}else{if(init_module!==""&&init_record!==""&&Beans[init_module]!==undefined){Beans[init_module].CurrentId=init_record;l="#"+init_module+"DetailsPage";init_module="";init_record=""}}$("#LoginForm").append(j);AfterLogin(l,(!mobile_app))})}init_done=true;$.mobile.fixedtoolbar.prototype.options.tapToggle=false;if(mobile_app){}try{if($.mobile.urlHistory.stack[0].pageUrl==="HomePage"){$("#HomePage").trigger("pagecreate")}}catch(d){}var b=new Date();if(!b.isDST()){TimeZoneOffset++}var h;var f=mobile_app||(getCookie("RememberMe")==="1"),k=mobile_app?Quser_name:getCookie("username"),a=mobile_app?$.md5(Qpwd):getCookie("SugarP"),e,j='<fieldset data-role="controlgroup" data-mini="true"><input type="checkbox" name="RememberMe" id="RememberMe" class="custom" data-theme="c" /><label for="RememberMe">'+RES_REMEMBER_ME+'</label></fieldset><div style="margin:0 auto; margin-left:auto; margin-right:auto; align:center; text-align:center;"><a id="LoginButton" href="javascript:LoginUser();" data-role="button" data-inline="true" data-mini="true">'+RES_LOGIN_TITLE+"</a></div>";if(QCRM.OffLine){}else{if(f&&!ForceLogin&&k!==null&&k!==""&&a!==null&&a!==""){var g=false;setTimeout(function(){if(!g){AjaxErr()}},6000);seamlessLogin(function(l){g=true;if(l===null){if(!QCRM.OffLine){$("#LoginLoading").html("unexpected error. Please check your permissions and SugarCRM log file")}}else{if(l===1||l.name_value_list!==undefined){if(l.name_value_list!==undefined){SugarSessionId=l.id;CurrentUserId=l.name_value_list.user_id.value;localStorage.setItem("SugarId",CurrentUserId);if(typeof sugar_flavor!=="undefined"){if(sugar_flavor!=="CE"&&l.name_value_list.user_default_team_id&&l.name_value_list.user_default_team_id.value){CurrentProfileId=l.name_value_list.user_default_team_id.value;localStorage.setItem(ServerAddress+"SugarTeamId",CurrentProfileId);if(CurrentProfileId!==""){QCRM.setProfile()}}}}c()}else{if(mobile_app){}else{$("#LoginForm").append(j);$("#LoginLoading").hide();$("#LoginForm").show()}}}})}else{$("#LoginForm").append(j);$("#LoginPage").trigger("pagecreate");$("#LoginLoading").hide();$("#LoginForm").show()}}if(typeof QuickCRMInit==="function"){QuickCRMInit()}}function InitLoginPage(){$("#LoginPageMessage").text(RES_LOGIN_MESSAGE);$("#LoginPageTitle").text("QuickCRM"+(mobile_edition==="Pro"?" Pro":""));var a="NS-Team - QuickCRM "+mobile_edition+" - V"+mobile_version;$("#LoginFooter").html(a);$("#HomePageFooter").html(a);if(typeof QuickCRMBeforeLogin=="function"){QuickCRMBeforeLogin()}if(!mobile_app){var b="<em>* </em>";$("#SettingsUsernameLabel").html(b+RES_USERNAME_LABEL);$("#SettingsPasswordLabel").html(b+RES_PASSWORD_LABEL)}var c=getCookie("username");if(c!==null&&c!==""){$("#SettingsUsername").val(c)}}$("#LoginPage").live("pagecreate",InitLoginPage);$("#LoginPage").live("pageshow",function(a,b){if(!init_done){MobileInit()}if(home_created&&mobile_app&&!iOS){$.mobile.changePage("#HomePage")}if(!mobile_app){$("#RememberMe").checkboxradio();$("#LoginButton").button();$("#RememberMe").attr("checked",(getCookie("RememberMe")==="1")).checkboxradio("refresh")}$("#LoginLoading").hide();if(!ForceLogin&&SugarSessionId!==""){return}if(typeof QuickCRMBeforeLogin=="function"){QuickCRMBeforeLogin()}var c=getCookie("username");if(c!==null&&c!==""){$("#SettingsUsername").val(c)}});$("#HomePage").live("pagecreate",function(){AddPhonePopup("HomePage");if(mobile_edition==="CE"){$("#AboutPro").show()}if(!init_done){MobileInit()}$.mobile.page.prototype.options.backBtnTheme="a";if(typeof HomePageInit==="function"){HomePageInit()}if(!mobile_app){}else{}$("#NotifyClear").text(RES_CLEAR);if(IconsLabels){$("#AdminPageLinkLabel").text(RES_OPTIONS);$("#ActivitiesLinkLabel").text(RES_CALENDAR);$("#AllModulesLinkLabel").text(RES_ALLMODULES);$("#LastViewedLinkLabel").text(sugar_app_strings.LBL_LAST_VIEWED);$("#SyncPageLinkLabel").text(RES_SYNC);$("#MapsLinkLabel").text("Maps")}$("#LastViewedPanelDiv li").remove();GetBeansList(LastViewed,"LastViewedPanelDiv",true,sugar_app_strings.LBL_LAST_VIEWED,false);$("#PanelSearchText").attr("placeholder",RES_SEARCH_LABEL);function a(c){var d=null;function b(){if($("#PanelSearchText").val().length<2){$("#PanelSearchDiv").html("").listview("refresh")}else{GlobalSearch("PanelSearchText","PanelSearchDiv","",5,true)}}$("#PanelSearchText").bind("keyup change",function(){if(d){window.clearTimeout(d)}d=window.setTimeout(function(){d=null;b()},c)})}GetAllModulesList("AllModulesPopupDiv");a(200);if(!QCRM.JJWG){$("#MapsContainer").remove()}$("#OffLineContainer").remove()});$("#HomePage").live("pageshow",function(){if(!init_done){MobileInit()}home_created=true;if(SugarSessionId===""&&!QCRM.OffLine){$.mobile.changePage("#LoginPage")}RequestPassword()});function PasswordEntered(){if($("#EnterPassword").val()===Pref.AppLock){unlocked=true;$(".ui-dialog").dialog("close");localStorage.setItem("WrongPwd",0)}else{$("#PwdErr").text(RES_WRONG_PWD);var a=parseInt(localStorage.getItem("WrongPwd",0),10)+1;if(a>9){if(QCRM.OffLine){}AlertPopup("All data have been erased and your password has been removed from settings");localStorage.setItem("Spassword","");localStorage.removeItem("AppLock");localStorage.setItem("WrongPwd",0);AppReload()}else{localStorage.setItem("WrongPwd",a)}}}function RequestPassword(){if(Pref&&(Pref.AppLock!==false)&&!unlocked){setTimeout('$("#lnkPwd").click();',150)}}function SaveLockPage(){if(Pref.AppLock===false){var a=$("#DefPassword").val();if(a!==""){if(a===$("#DefPassword2").val()){localStorage.setItem("AppLock",a);localStorage.setItem("WrongPwd",0);Pref.AppLock=a;$("#LockPageCancelBtn").click()}else{$("#LockErr").text(RES_PWD_MISMATCH)}}}else{if($("#RemoveLock").val()===Pref.AppLock){localStorage.removeItem("AppLock");Pref.AppLock=false;$("#LockPageCancelBtn").click()}else{$("#LockErr").text(RES_WRONG_PWD)}}}$("#EnterPwdPage").live("pagecreate",function(){$("#EnterPasswordLabel").html(RES_ENTER_LOCK);$("#EnterPwdConfirmBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL)});$("#EnterPwdPage").live("pageshow",function(){$("#EnterPassword").val("");$("#PwdErr").text("")});function DisplayLockState(){if(Pref.AppLock!==false){$("#AppLocked").show();$("#AppUnlocked").hide()}else{$("#AppLocked").hide();$("#AppUnlocked").show()}}$("#LockPage").live("pagecreate",function(){$("#LockPageTitle").text(RES_TITLE_LOCK);$("#AppDefLockTitle").text(RES_DEF_LOCK);$("#AppUnlockTitle").text(RES_UNLOCK);$("#DefPasswordLabel").html(RES_ENTER_LOCK);$("#DefPassword2Label").html(RES_ENTER2_LOCK);$("#RemoveLockLabel").html(RES_ENTER_LOCK);$("#LockPageConfirmBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$("#LockPageCancelBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);DisplayLockState()});$("#LockPage").live("pageshow",function(){DisplayLockState();$("#DefPassword").val("");$("#DefPassword2").val("");$("#RemoveLock").val("");$("#LockErr").text("")});$("#AllOptions").live("pagecreate",function(){var a=(mobile_app?app_version:("web app "+mobile_edition+mobile_version)),b=(mobile_edition!=="Pro");if(typeof GetDemo==="function"){if(GetDemo()&&!iOS){b=true}}$("#AllOptionsTitle").text(RES_OPTIONS);$("#OptionsGeneralLnk").text(RES_OPT_GENERAL);$("#OptionsHomeLnk").text(RES_HOME_LABEL);$("#OptionsSortOrderLnk").text(RES_SORTORDER);$("#OptActDiv").remove();$("#OptFilterOldDiv").remove();if(b){$("#OptGetProLnk").text(RES_UNAVAILABLE)}else{$("#OptGetPro").remove()}$("#ContactNSTEAMContainer").html('<a href="mailto:support@quickcrm.fr?subject=Support Request from '+a+'">support@quickcrm.fr</a>');$("#OptSyncDiv").remove()});$("#OptionsGeneral").live("pagecreate",function(){$("#OptionsGeneralTitle").text(RES_OPT_GENERAL);$('label[for="OptRowsPerPage"]').text(RES_ROWS_PER_PAGE);$("#RowsPerDashlet").hide();$("#OptToolbarLbl").text(RES_TOOLBAR);$('label[for="OptIconsLabels"]').text(RES_SHOWLABELS);$("#OptAlertsLbl").text(RES_ALERTS);$('label[for="OptAlerts"]').text(RES_UPDATED);$("#OptHideEmptySubPLbl").text(RES_SUBPANELS);$('label[for="OptHideEmptySubP"]').text(RES_HIDEEMPTY);if(!mobile_app&&mobile_edition!=="Pro"){$("#OptAlertDiv").hide()}if(!iOS){$("#OptionsGeneral input[type=checkbox]").live("change",function(a){$("#OptionsGeneral input[type=checkbox]").checkboxradio("refresh")})}});$("#OptionsGeneral").live("pageshow",function(){$("#OptRowsPerPage").val(RowsPerPage).slider("refresh");$("#OptIconsLabels").attr("checked",tmpIconsLabels).checkboxradio("refresh");$("#OptHideEmptySubP").attr("checked",Pref.HideEmptySubP).checkboxradio("refresh")});function OptionsGeneralSave(){var a=false;RowsPerPage=$("#OptRowsPerPage").val();RowsPerDashlet=$("#OptRowsPerDashlet").val();Pref.HideEmptySubP=$("#OptHideEmptySubP").is(":checked");if(IconsLabels!==$("#OptIconsLabels").is(":checked")){a=true;tmpIconsLabels=$("#OptIconsLabels").is(":checked")}updatePreferences(false);setCookie("OptRowsPerPage",RowsPerPage,365);setCookie("OptIconsLabels",($("#OptIconsLabels").is(":checked")?1:0),365);localStorage.setItem("Alerts",(Pref.Alerts?"1":"0"));localStorage.setItem("HideEmptySubP",(Pref.HideEmptySubP?"1":"0"));if(a){ConfirmPopup(RES_AVAILABLE_NEXT_LOGIN,function(){LogOutUser()},"")}}$("#OptionsHome").live("pagecreate",function(){$("#OptionsHomeTitle").text(RES_HOME_LABEL);var d=$("#OptHomeIcons");for(var c in QCRM.beans){var b=QCRM.beans[c],a=sugar_app_list_strings.moduleList[b];if(Beans[b].Enabled()){d.append('<input type="checkbox" name="Home'+b+'" id="Home'+b+'" data-theme="c" checked="checked"/><label for="Home'+b+'">'+a+"</label>")}}if(!iOS){$("#OptionsHome input[type=checkbox]").live("change",function(f){$("#OptionsHome input[type=checkbox]").checkboxradio("refresh")})}});$("#OptionsHome").live("pageshow",function(){for(var a in QCRM.beans){var b=QCRM.beans[a];if(Beans[b].Enabled()){$("#Home"+b).attr("checked",(Pref.Hidden.indexOf(b)===-1)).checkboxradio("refresh")}}});function OptionsHomeSave(){var f="";var h=[];var g="";var a=[];for(var e in QCRM.beans){var d=QCRM.beans[e],c=false,b=false;if(Beans[d].Enabled()){if(!$("#Home"+d).is(":checked")){c=true}if($("#Create"+d).is(":checked")){b=true}}else{if(Pref.Hidden.indexOf(d)!==-1){c=true}if(Pref.Creates.indexOf(d)!==-1){b=true}}if(c){h=h.concat(d);f+=(f===""?"":",")+d}if(b){a=a.concat(d);g+=(g===""?"":",")+d}}Pref.Hidden=h;Pref.Creates=a;updatePreferences(false);setCookie(ServerAddress+"Icons",f,365);setCookie("Creates",g,365)}function createSortOrderDropdown(d,n,c){var e="",o=true,p=Beans[c].OrderBy;if(p!==""){p=p.split(" ");e=p[0];if(p.length>1){o=p[1]==="asc"}}var k=$("<div data-role='fieldcontain'/>"),j=$("<fieldset data-role='controlgroup' data-type='horizontal'/>");j.append("<legend>"+n+"</legend>");var b=$("<select name='"+d+"field' id='"+d+"field' data-mini='true' data-theme='c'/>"),i=[""].concat(Beans[c].AllOrderFields().concat(["date_entered","date_modified"])),q="";for(var a in i){var m=i[a],h=display_label(c,m);h=(h===""?"&nbsp;":h);q+="<option value='"+(m===""?"EMPTY":m)+"'"+(m===e?" selected='selected'":"")+">"+h+"</option>"}b.append(q);j.append(b);b=$("<select name='"+d+"order' id='"+d+"order' data-mini='true' data-theme='c'/>");b.append("<option value='asc'"+(o?" selected='selected'":"")+">asc</option><option value='desc'"+(!o?" selected='selected'":"")+">desc</option>");j.append(b);k.append(j);return k}function readSortOrderDropdown(a,b){var c=$("#"+a+"field").val();return((c===""||c==="EMPTY"||c===undefined)?"":(c+" "+$("#"+a+"order").val()))}function loadSortOrderDropdown(b,d,a){var c,f,e;if(a&&a!==""){c=a.split(" ");f=c[0];if(c.length>1){e=c[1]}}else{f="EMPTY"}if(field==""){field="EMPTY"}set_enum_val("#"+b+"field",f);set_enum_val("#"+b+"order",e)}$("#OptionsSortOrder").live("pagecreate",function(){$("#OptionsSortOrderTitle").text(RES_SORTORDER);var a=$("#ModulesListSort");for(var e in QCRM.beans){var c=QCRM.beans[e],b=sugar_app_list_strings.moduleList[c];if(Beans[c].Enabled()){var f=$("<li/>");a.append(f.append(createSortOrderDropdown("Order"+c,sugar_app_list_strings.moduleList[c],c)))}}});$("#OptionsSortOrder").live("pageshow",function(){});function OptionsSortOrderSave(){var c="";for(var b in SearchPages){var a=SearchPages[b];if(!Beans[a].Enabled()){continue}var d=readSortOrderDropdown("Order"+a,a);Beans[a].OrderBy=d;c+=(c===""?"{":",")+'"'+a+'":"'+d+'"'}c+=(c===""?"":"}");setCookie("SortOrder",c,365)}$("#OptionsFilterOld").live("pagecreate",function(){});$("#OptionsFilterOld").live("pageshow",function(){});function OptionsFilterOldSave(){}$("#OptionsAct").live("pagecreate",function(){$("#OptionsActTitle").text(RES_OPT_CALL_MEET);$('label[for="OptLogCalls"]').text(RES_LOG_CALLS);$("#OptLogCallsLbl").text(sugar_app_list_strings.moduleList.Calls);$('label[for="OptActMyItems"]').text(sugar_app_strings.LBL_CURRENT_USER_FILTER);$("#OptActMyItemsLbl").text(sugar_app_strings.LBL_ASSIGNED_TO);$('label[for="ActivitiesFrom"]').text(RES_OPT_FROM);$('label[for="ActivitiesTo"]').text(RES_OPT_TO);$("#OptActStatusLbl").text(sugar_mod_strings.Meetings?sugar_mod_strings.Meetings.LBL_STATUS:(sugar_mod_strings.Calls?sugar_mod_strings.Calls.LBL_STATUS:"Status"));var a=sugar_app_list_strings.meeting_status_dom?sugar_app_list_strings.meeting_status_dom:{Planned:"Planned",Held:"Held","Not Held":"Not Held"};$('label[for="ActStatus_planned"]').text(a.Planned);$('label[for="ActStatus_held"]').text(a.Held);$('label[for="ActStatus_not_held"]').text(a["Not Held"]);if(!iOS){$("#OptionsAcs input[type=checkbox]").live("change",function(b){$("#OptionsAct input[type=checkbox]").checkboxradio("refresh")})}});$("#OptionsAct").live("pageshow",function(){$("#ActivitiesTo").val(Pref.ActivitiesTo).slider("refresh");$("#ActivitiesFrom").val(Pref.ActivitiesFrom).slider("refresh");$("#OptActMyItems").attr("checked",Pref.ActivitiesMine).checkboxradio("refresh");$("#OptLogCalls").attr("checked",Pref.LogCalls).checkboxradio("refresh");$("#ActStatus_planned").attr("checked",Pref.Activities_planned).checkboxradio("refresh");$("#ActStatus_held").attr("checked",Pref.Activities_held).checkboxradio("refresh");$("#ActStatus_not_held").attr("checked",Pref.Activities_not_held).checkboxradio("refresh")});function OptionsActSave(){Pref.ActivitiesTo=$("#ActivitiesTo").val();Pref.ActivitiesFrom=$("#ActivitiesFrom").val();Pref.ActivitiesMine=$("#OptActMyItems").is(":checked");Pref.Activities_planned=$("#ActStatus_planned").is(":checked");Pref.Activities_held=$("#ActStatus_held").is(":checked");Pref.Activities_not_held=$("#ActStatus_not_held").is(":checked");Pref.LogCalls=$("#OptLogCalls").is(":checked");updatePreferences(false);setCookie("ActivitiesTo",Pref.ActivitiesTo,365);setCookie("ActivitiesFrom",Pref.ActivitiesFrom,365);setCookie("OptLogCalls",(Pref.LogCalls?1:0),365);setCookie("OptActMyItems",(Pref.ActivitiesMine?1:0),365);setCookie("ActStatus_planned",(Pref.Activities_planned?1:0),365);setCookie("ActStatus_held",(Pref.Activities_held?1:0),365);setCookie("ActStatus_not_held",(Pref.Activities_not_held?1:0),365)}$("#OptionsSync").live("pagecreate",function(){});$("#OptionsSync").live("pageshow",function(){});function OptionsSyncSave(){}$("#ActivitiesListPage").live("pagecreate",function(){AddPhonePopup("ActivitiesListPage");$("#ActivitiesListPageTitle").text(RES_CALENDAR);$('label[for="ActPeriod_missed"]').html(RES_MISSED);$('label[for="ActPeriod_today"]').html(sugar_app_list_strings.date_search.today);$('label[for="ActPeriod_7days"]').html(RES_7DAYS);$('label[for="ActPeriod_30days"]').html(RES_7DAYS.replace("7","30"));$("#ActivitiesListPageSubMenu input:radio").change(function(a,b){GetActivitiesList(ActivitiesCurrentOffset)})});$("#LastViewedListPage").live("pagecreate",function(){$("#LastViewedListPageTitle").text(sugar_app_strings.LBL_LAST_VIEWED)});$("#AllModulesListPage").live("pagecreate",function(){$("#AllModulesListPageTitle").text(RES_ALLMODULES);GetAllModulesList("AllModulesListDiv")});$("#ActivitiesListPage").live("pageshow",function(){GetActivitiesList(ActivitiesCurrentOffset)});$("#LastViewedListPage").live("pageshow",function(){GetLastViewedList()});function ShowHideToolbarLabels(){var k="",h,d=(IconsLabels?RES_HOME_LABEL:""),f=(IconsLabels?sugar_app_strings.LBL_CREATE_BUTTON_LABEL:k),g=(IconsLabels?sugar_app_strings.LBL_BACK:k),l=(IconsLabels?RES_ALLMODULES:k),e=(IconsLabels?sugar_app_strings.LBL_EDIT_BUTTON:k),o=(IconsLabels?sugar_app_strings.LBL_DELETE_BUTTON_LABEL:k),q=(IconsLabels?sugar_app_strings.LBL_LAST_VIEWED:k),j=(IconsLabels?RES_CALENDAR:k),p=(IconsLabels?sugar_app_strings.LBL_SEARCH_BUTTON_LABEL:k),n=(IconsLabels?sugar_app_strings.LNK_LIST_NEXT:k),a=(IconsLabels?sugar_app_strings.LNK_LIST_PREVIOUS:k);for(h in ListsPages){var m="#"+ListsPages[h];$(m+"ListPageHomeBtn").text(d);$(m+"AllModulesBtn").text(l);$(m+"CalendarBtn").text(j);$(m+"GSBtn").text(p);$(m+"LBackBtn").text(g);$(m+"LastViewedBtn").text(q)}for(h in SearchPages){var c="#"+SearchPages[h];$(c+"SHomeBtn").text(d);$(c+"ListPageSearchBtn").text(p);$(c+"PreviousBtn").text(a);$(c+"SBackBtn").text(g);$(c+"NextBtn").text(n);if(Beans[SearchPages[h]].AddBtn){$(c+"ListPageAddBtn").text(f);$(c+"SAddBtn").text(f)}}for(h in ViewPages){var b="#"+ViewPages[h];$(b+"HomeBtn").text(d);$(b+"SearchBtn").text(IconsLabels?sugar_app_list_strings.moduleList[ViewPages[h]]:k);$(b+"BackBtn").text(g);$(b+"EditBtn").text(e);$(b+"DelBtn").text(o)}}function seamlessLogin(d,c){if(!c&&QCRM.OffLine){d(null)}else{var a=mobile_app?'"encryption":"PLAIN",':"",b=mobile_app?Qpwd:getCookie("SugarP")}SugarQuery("login","[{"+a+'"password":"'+(mobile_app?Qpwd:getCookie("SugarP"))+'","user_name":"'+(mobile_app?Quser_name:getCookie("username"))+'"},"",""]',function(e){if(e!==null&&mobile_app&&e.name!==undefined){SugarQuery("login",'[{"password":"'+$.md5(Qpwd)+'","user_name":"'+Quser_name+'"},"",""]',function(f){d(f)})}else{d(e)}})}function AfterLogin(m,n){var h;Beans.Contacts.TitleFields=["first_name","last_name"];Beans.Leads.TitleFields=["first_name","last_name"];Beans.Accounts.Fields=["phone_office","phone_fax","website","email1","description","assigned_user_name"];Beans.Contacts.Fields=["title","account_name","email1","phone_work","phone_mobile","description","assigned_user_name"];Beans.Leads.Fields=["title","account_name","status","email1","phone_work","phone_mobile","description","assigned_user_name"];Beans.Opportunities.Fields=["amount","date_closed","sales_stage","account_name","description","assigned_user_name"];Beans.Calls.Fields=["direction","status","date_start","duration_hours","duration_minutes","description","parent_name","assigned_user_name"];Beans.Meetings.Fields=["status","date_start","duration_hours","duration_minutes","description","parent_name","assigned_user_name"];Beans.Tasks.Fields=["status","date_start","date_due","priority","description","parent_name","assigned_user_name"];Beans.Notes.Fields=["description","filename"];Beans.Accounts.Addresses=["billing","shipping"];Beans.Contacts.Addresses=["primary","alt"];Beans.Leads.Addresses=["primary","alt"];Beans.Cases.Fields=["case_number","type","status","priority","account_name","description"];Beans.Project.Fields=["status","priority","description"];Beans.ProjectTask.Fields=["status","priority","percent_complete","assigned_user_name","project_name","description"];if(!PagesCreated){QCRM.enableBeans(["Accounts","Contacts","Opportunities","Leads","Calls","Meetings","Tasks","Cases","Project","ProjectTask","Notes"])}try{var d=["","on","isnull","greater_than","less_than","before","after","not_equal","last_7_days","last_30_days"];for(var e in d){if(sugar_app_list_strings.date_search[d[e]]!==undefined){delete sugar_app_list_strings.date_search[d[e]]}}sugar_app_list_strings.date_search["="]=" --- ";if(sugar_version<"6.2"){var o=sugar_app_list_strings.date_search.between_dates;sugar_app_list_strings.date_search.between=o;delete sugar_app_list_strings.date_search.between_dates}}catch(c){}SimpleBeans.Users.DefValue=CurrentUserId;for(h in SimpleBeans){SimpleBeans[h].Load(SimpleBeans[h].AfterLoad)}for(h in SearchPages){var a=SearchPages[h];if(sugar_mod_fields[a]===undefined||Beans[a].access==="none"){Beans[a].access="none";$("#Icon"+a).remove()}}if(sugar_app_list_strings.parent_type_display===undefined){sugar_app_list_strings.parent_type_display=sugar_app_list_strings.moduleList;delete sugar_app_list_strings.parent_type_display.Users}defaultPreferences();updatePreferences(true);for(h in ViewPages){var p=ViewPages[h],q=Beans[p];var g=q.AllFields();for(var l in g){var b=sugar_mod_fields[p][g[l]];if(b!==undefined&&b.type==="phone"){q.PhoneFields.push(g[l])}}q.ListFields=q.ListFields.concat(q.PhoneFields);q.CreateHook()}if(m!==""){$.mobile.changePage(m)}$.mobile.hidePageLoadingMsg();if(n){$("#LoginLoading").hide();$("#LoginForm").show()}for(h in js_plugins){var k=QCRM[js_plugins[h].substr(0,js_plugins[h].length-3)];if(typeof k==="function"){k()}}if(QCRM.JJWG){JJWG.jjwg_init()}QCRM.updateBeans();if(!Beans.Meetings.Enabled()&&!Beans.Calls.Enabled()){$("#ActivitiesContainer").remove()}if(QCRM.OffLine&&typeof QuickCRMAfterLogin=="function"){}}function onResume(){if(!QCRM.OffLine){$.mobile.showPageLoadingMsg();seamlessLogin(function(a){if(a&&a.id&&a.name_value_list!==undefined){SugarSessionId=a.id;CurrentUserId=a.name_value_list.user_id.value;localStorage.setItem("SugarId",CurrentUserId);if(Pref.Alerts){CronAlerts()}}$.mobile.hidePageLoadingMsg()})}if(QCRM.JJWG&&JJWG.gps_enabled){setTimeout(function(){navigator.geolocation.getCurrentPosition(JJWG.onPositionUpdate)},100)}unlocked=(Pref.AppLock===false);RequestPassword()}function onPause(){if(!QCRM.OffLine){if(Pref.Alerts){StopAlerts()}}}function LoginUser(g,f){var h=$("#SettingsUsername").val(),d,b=$("#SettingsPassword").val(),e=false,a="";$.mobile.showPageLoadingMsg();if(!g){if(sugar_version>="6.3"){a='"encryption":"PLAIN",'}else{b=$.md5(b)}d=b}setTimeout(function(){if(!e){AjaxErr()}},4000);SugarQuery("login","[{"+a+'"password":"'+b+'","user_name":"'+h+'"},"",""]',function(i){e=true;if(i){if(i.name!==undefined){$.mobile.hidePageLoadingMsg();g===undefined?LoginUser(true):AlertPopup(RES_WRONG_PASWD)}else{SugarSessionId=i.id;CurrentUserId=i.name_value_list.user_id.value;setCookie("username",$("#SettingsUsername").val(),365);$("#SettingsUsername").val("");$("#SettingsPassword").val("");var c=$("#RememberMe").is(":checked");setCookie("RememberMe",(c?1:0),10);setCookie("SugarP",(d===undefined?b:d),365);localStorage.setItem("SugarId",CurrentUserId);AfterLogin(f===undefined?"#HomePage":f)}}else{AlertPopup("An unexpected error occurred logging in.");$.mobile.hidePageLoadingMsg()}})}function Disconnect(){setCookie("RememberMe",0,10)}function LogOutUser(){ForceLogin=(!mobile_app);SugarQuery("logout",'[{"session":"'+SugarSessionId+'"}]',function(){AppReload()})}function GetBeansList(k,o,h,c,n){var p,i=k.length;if(c!==undefined&&c!==""){$("#"+o).append('<li data-role="list-divider" data-theme="a">'+c+"</li>")}for(p=0;p<i;p++){var m=k[p],g=$("<li"+(h?' data-icon="false"':"")+"/>");if(Beans[m.module]!==undefined){var j=m.name,a=createLink(m.module,m.id);if(h){a.css({"font-size":"12px"})}a.addClass(m.module+"SIcon");a.css({"padding-left":"20px"});a.append(j);g.append(a);$("#"+o).append(g)}}if(n===undefined||n===true){$("#"+o).listview("refresh")}}function Remove1FromList(d,b,f){var e,a=d.length;for(e=0;e<a;e++){if(d[e].id===f){d.splice(e,1);break}}}function SaveList(d,b){var e="a",f,a=d.length;for(f=0;f<a;f++){e+="@@"+d[f].id+"@@"+d[f].module+"@@"+d[f].name}localStorage.setItem(b,e)}function LoadList(e){var d=localStorage.getItem(e);var f=[];if(d!==null&&d!==""&&d!=="a"){d=d.split("@@");var c,a=(d.length-1)/3;for(c=0;c<a;c++){f[c]={id:d[3*c+1],module:d[3*c+2],name:d[3*c+3]}}}return f}function PushViewed(b,c,a){Remove1FromLastviewed(b,c);LastViewed.unshift({module:b,id:c,name:a});if(LastViewed.length>10){LastViewed.pop()}SaveLastviewed()}function GetLastViewedList(){$.mobile.showPageLoadingMsg();$("#LastViewedListDiv li").remove();GetBeansList(LastViewed,"LastViewedListDiv",false,"",true);$.mobile.hidePageLoadingMsg()}function SaveLastviewed(){SaveList(LastViewed,"LastViewed");$("#LastViewedPanelDiv li").remove();GetBeansList(LastViewed,"LastViewedPanelDiv",true,sugar_app_strings.LBL_LAST_VIEWED,true);$("#HomePanel").trigger("updatelayout")}function Remove1FromLastviewed(a,b){Remove1FromList(LastViewed,a,b)}function RemoveFromLastviewed(a,b){Remove1FromLastviewed(a,b);SaveLastviewed()}$("#GSListPage").live("pagecreate",function(){$("#GSPageTitle").text(RES_SEARCH_LABEL)});$("#GlobalSearch").live("pagecreate",function(){$("#GlobalSearchTitle").text(RES_SEARCH_LABEL);$("#GSSubmit").text(sugar_app_strings.LBL_SEARCH_BUTTON_LABEL);enableButton("GSSubmit",false);$("#GSSearchText").bind("keyup",function(a,b){enableButton("GSSubmit",$("#GSSearchText").val().length>=2)})});QCRM.GSBeans=[];QCRM.updateBeans=function(){var a=["Accounts","Contacts","Leads","Opportunities","Cases","Project"];QCRM.GSBeans=[];if(QCRM.OffLine){}else{if(sugar_version>"6.5"){a.push("Tasks")}}$.each(a,function(b,c){if(Beans[c]!==undefined&&Beans[c].Enabled()){QCRM.GSBeans.push(c)}});$.each(QCRM.beans,function(b,f){var d=Beans[f];if(d!==undefined&&d.Enabled()&&d.CustomListFields.length>0){var c=d.CustomListFields,e,g=(sugar_mod[f].type==="person"?"<h4>{first_name} {last_name}</h4><p>":("<h4>"+(f==="Documents"?"{document_name}":"{name}")+"</h4><p>"));for(e in c){if(Beans[f].ListFields.indexOf(c[e])===-1){Beans[f].ListFields.push(c[e])}if(Pref.FieldsLabels){g+=((e>0)?" - ":"")+display_label(f,c[e])+" {"+c[e]+"}"}else{g+=(e==3?"<br>":"")+"{"+((e>0&&e!=3)?"-":"")+c[e]+"}"}}g+="</p>";if(Beans[f].CustomListViewTpl===false){Beans[f].ListViewTpl=g}else{Beans[f].ListViewTpl=Beans[f].CustomListViewTpl}}});if(typeof CustomUpdateBean==="function"){$.each(QCRM.beans,function(b,c){if(Beans[c]!==undefined&&Beans[c].Enabled()){CustomUpdateBean(c)}})}$.each(QCRM.beans,function(b,d){var c=Beans[d];if(c!==undefined&&c.Enabled()){ComputeFieldsToUpdate(d)}});$.each(["Calls","Meetings","Tasks","Cases"],function(b,c){if(Beans[c].Enabled()){ComputePhoneFields(c)}});if(typeof OLUpdateBean==="function"){$.each(QCRM.beans,function(b,c){if(Beans[c]!==undefined&&Beans[c].Enabled()){OLUpdateBean(c)}})}};function GlobalSearch(b,d,f,a,c){var e=[],g="%"+$("#"+b).val()+"%";if(g.length<2||QCRM.GSBeans.length===0){return}if(f!=""){$.mobile.changePage("#"+f)}$.mobile.showPageLoadingMsg();$("#"+d+" li").remove();QCRM.search_by_module(QCRM.GSBeans,g,0,a,function(o){if(o&&o.entry_list!==undefined){var i,j=o.entry_list.length;for(i=0;i<j;i++){var h=o.entry_list[i],k=h.records.length,n;for(n=0;n<k;n++){e.push({module:h.name,id:h.records[n].id.value,name:h.records[n].name.value})}}GetBeansList(e,d,c)}$.mobile.hidePageLoadingMsg()})}var LastModified=[],tmpLastModified=[],cronLastModifiedId=false;function GetAllModulesList(h){$("#"+h+" li").remove();SearchPages=SearchPages.sort(function(e,d){return sugar_app_list_strings.moduleList[e]<sugar_app_list_strings.moduleList[d]?-1:1});var c,a=SearchPages.length;for(c=0;c<a;c++){var m=SearchPages[c];if(Beans[m].Enabled()){var i=$("<li data-icon='plus' data-split-theme='d'/>"),k=sugar_app_list_strings.moduleList[Beans[m].name],g=$("<a/>",{href:"#"+Beans[m].name+"Search"});g.addClass(Beans[m].name+"SIcon");g.css({"padding-left":"20px"});g.append(k);i.append(g);var j=$("<a/>",{href:"#"});j.click({page:SearchPages[c]},function(b){Beans[b.data.page].Create()});i.append(j);$("#"+h).append(i)}}}function LogCall(b,f,e,d){}function defaultPreferences(){var b;LastViewed=LoadList("LastViewed");LastModified=LoadList("LastModified");b=getCookie("OptIconsLabels");if(b==="1"){IconsLabels=true}else{if(b==="0"){IconsLabels=false}}tmpIconsLabels=IconsLabels;Pref={AppLock:false,LogCalls:false,Alerts:mobile_app,FilterOldDate:"",FilterOld:[],FieldsLabels:false,HideEmptySubP:true,Hidden:[],Disabled:[],SyncModules:{},ActivitiesWhere:"",ActivitiesFrom:0,ActivitiesTo:0,Activities_planned:true,Activities_held:true,Activities_not_held:true,ActivitiesMine:false};b=getCookie("SortOrder");if(b!==null&&b!==""){b=jQuery.parseJSON(b);for(var a in b){if(Beans[a]!==undefined){Beans[a].OrderBy=b[a]}}}if(mobile_app){b=localStorage.getItem("AppLock");if(b!==null&&b!==""){Pref.AppLock=b;unlocked=false}}b=getCookie("OptRowsPerPage");if(b!==null&&b!==""){RowsPerPage=b}b=getCookie("OffLineNb");if(b!==null&&b!==""){Pref.OffLineNb=b}b=getCookie(ServerAddress+"Icons");if(b===null){b=getCookie("Icons");if(typeof GetDemo==="function"){if(GetDemo()){b="Calls,Meetings,Tasks,Notes,Cases,Project,ProjectTask"}}}if(b!==null){if(b!==""){b=b.split(",");for(var a in b){if(QCRM.beans.indexOf(b[a])!==-1){Pref.Hidden=Pref.Hidden.concat(b[a])}}}}else{$.each(QCRM.beans,function(c,d){if(!Beans[d].HomeIcon){Pref.Hidden=Pref.Hidden.concat(d)}})}b=localStorage.getItem("FilterOldDate");if(b!==null){Pref.FilterOldDate=b}b=localStorage.getItem("FilterOld");if(b!==null){Pref.FilterOld=[];if(b!==""){b=b.split(",");for(var a in b){if(QCRM.beans.indexOf(b[a])!==-1){Pref.FilterOld=Pref.FilterOld.concat(b[a])}}}}}function updatePreferences(a){if(a){ShowHideToolbarLabels()}$.each(QCRM.beans,function(b,c){if(Pref.Hidden.indexOf(c)===-1&&(!QCRM.OffLine||Pref.SyncModules[c].sync!=="None")){$("#Icon"+c).show()}else{$("#Icon"+c).hide()}})}function display_label(c,d){var a=sugar_mod_fields[c];if(a[d]===undefined){return d}if((a[d].type==="boolean")||(a[d].type==="bool")){return""}var b=a[d].label;if(sugar_mod_strings[c][b]===undefined||sugar_mod_strings[c][b]===""||sugar_mod_strings[c][b]===null){return b}return sugar_mod_strings[c][b]}function display_value(a,n,o){if(sugar_mod_fields[a]===undefined){return""}else{if(sugar_mod_fields[a][n]===undefined){return o}}var c=sugar_mod_fields[a][n];switch(c.type){case"name":case"varchar":case"char":return o;case"text":return o.replace(/\\n/g,"<br>").replace(/\n/g,"<br>").replace(/\\r/g,"").replace(/\r/g,"");case"enum":var j=sugar_app_list_strings[c.options][o];return(j===undefined?o:j);case"multienum":if(o.length<=2){return""}var g=o.substr(1,o.length-2).replace(/\^,\^/g,"%").replace(/\^\^/g,"%").split("%"),k="<ul>",h=g.length,f;for(f=0;f<h;f++){var d;d=sugar_app_list_strings[c.options][g[f]];k+="<li>"+(d===undefined?g[f]:d)+"</li>"}return k+"</ul>";case"date":if(!o||o.length<10){return""}return jQuery.mobiscroll.formatDate(date_format,fromDBDate(o));case"datetime":if(!o||o.length<14){return""}return jQuery.mobiscroll.formatDate(datetime_format,fromDBDateTime(o));case"currency":if(o===""){o="0"}return parseFloat(o).toFixed(2);case"float":case"decimal":if(o===""){return""}else{return parseFloat(o).toString()}case"bool":case"boolean":var l=sugar_mod_strings[a][sugar_mod_fields[a][n].label]+"&nbsp;";return l+'<input type="checkbox" disabled="disabled" '+((o===1||o==="1")?'checked="checked"':"")+" />";case"url":o=o.trim();if(o===""){return""}var m=o.substring(0,4)!=="http"?("http://"+o):o;return(m==="http://")?"":('<a href="'+m+'" rel="external" target="_blank" style="text-decoration:none;color:#444;" >'+m+"</a>");case"email":o=o.trim();if(o===""){return""}return'<a href="mailto:'+o+'" rel="external" target="_blank" style="text-decoration:none;color:#444;" >'+o+"</a>";default:break}return o}function display_default(a,c){if(sugar_mod_fields[a]===undefined){return""}else{if(sugar_mod_fields[a][c]===undefined){return""}else{if(c=="assigned_user_id"){return""}}}var b=sugar_mod_fields[a][c];return(b.def===null?"":b.def)}function display_address(r,a,e,l){var i,n,t=r[e+"_address_street"].value,p=r[e+"_address_city"].value,q=r[e+"_address_state"].value,m=r[e+"_address_postalcode"].value,b=display_value(a,e+"_address_country",r[e+"_address_country"].value);if(t!==""||p!==""||q!==""||m!==""||b!==""){var o=Addresses_Template.replace("$street",t).replace("$postalcode",m).replace("$state",q).replace("$city",p).replace("$country",b).replace(/\\r/g,"").replace(/\\n/g,"<br/>").replace(/\n/g,"<br/>");var h="#Map"+a,k=$("<li id='"+a+e+"'/>"),g="<h4>"+o+"</h4>",j=t+"%20"+p+"%20"+(q!==""?(q+"%20"):"")+m;j=j.replace(/\n/g,"%20").replace(/&#039;/g,"'");if(QCRM.JJWG&&JJWG.googlemaps&&r.jjwg_maps_geocode_status_c&&r.jjwg_maps_geocode_status_c.value==="OK"){i=$('<a href="#"/>');i.click({coord:{lat:r.jjwg_maps_lat_c.value,lng:r.jjwg_maps_lng_c.value},label:('<a href="#'+a+'DetailsPage" onclick="Beans[\''+a+"'].CurrentId='"+r.id.value+"';\">"+Beans[a].DisplayTitle(r)+"</a><br>"+r.jjwg_maps_address_c.value),module:a,id:r.id.value},function(c){JJWG.ShowMapBean(c.data.coord,c.data.label,c.data.module,c.data.id)})}else{if(mobile_app&&!iOS){i=$("<a/>",{href:h,"data-rel":"popup","data-position-to":"window"});i.click({field:a+e,address:j,module:a},function(c){OpenMap(c.data.field,c.data.module,c.data.address)})}else{i="http://maps.google.com/?q="+j+"&t=m&z=13&iwloc=near&output=html";i=$("<a/>",{href:i,rel:"external",target:"_blank",style:"text-decoration:none;color:#444;"})}}i.append("<p>"+sugar_mod_strings[a]["LBL_"+e.toUpperCase()+"_ADDRESS"]+"</p>");i.append(g);k.append(i);$(l).append(k)}}function set_enum_val(a,b){$(a).val(b);$(a+" option").attr("selected",false);if(b===""){b="EMPTY"}$(a+" option[value='"+b+"']").attr("selected","selected");$(a).selectmenu("refresh")}function set_bool_val(a,c,b){$(a+"0").attr("checked",b?false:"checked").checkboxradio("refresh");$(a+"1").attr("checked",b?"checked":false).checkboxradio("refresh")}function getRelatedList(d,h){var e=Beans[d].CurrentId,c=Beans[d].Links[h].module,j=(Beans[c]===undefined?SimpleBeans[c]:Beans[c]),i="#"+d+"DetailsPage"+h+"ListUl";if(j.Enabled()){$(i+" li").remove();var k=((mobile_edition==="Pro")&&(Beans[c]!==undefined&&Beans[c].access==="edit")&&Beans[d].Links[h].create),l=$("<li "+(k?"data-icon='plus'":"data-role='list-divider'")+" data-theme='b'/>");var b=sugar_app_list_strings.moduleList[c];if(Beans[d].CustomLinks&&Beans[d].CustomLinks[h]&&Beans[d].CustomLinks[h].title!==undefined){var f=Beans[d].CustomLinks[h].title;if(sugar_mod_strings[d][f]!==undefined){b=sugar_mod_strings[d][f]}else{if(f!==Beans[d].Links[h].module){b=f}}}if(k){var a=$("<a/>",{href:"#",click:function(){Beans[c].Create(d,h)}});a.append(b);l.append(a)}else{l.append(b)}var g=j.DisplaySubpanelFilter();if(Beans[c]!==undefined&&Pref.FilterOldDate!==""&&Pref.FilterOld.indexOf(c)!==-1){g+=(g===""?"":" AND ")+"date_entered>'"+Pref.FilterOldDate+"'"}QCRM.get_relationships(d,c,e,h,g,j.ListFieldsToSelect(),function(u){if(u){if(u&&u.entry_list!=undefined){if(u.entry_list.length>0){$(i).append(l);var r=0,p=u.entry_list.length,o=(d==="Accounts"?"Accounts":""),s=(d==="Accounts"?Beans.Accounts.CurrentId:"");for(r=0;r<p;r++){var t=u.entry_list[r],n=t.module_name,m,q;if(Beans[n]!==undefined){q=Beans[n].DisplaySubpanelRecord(t.id,t.name_value_list,d+"DetailsPage",d)}else{q=$("<li/>");m=SimpleBeans[n].DisplaySubpanelElt(t.name_value_list);q.append(m)}$(i).append(q)}$(i).show()}else{if(Pref.HideEmptySubP&&!k){$(i).hide()}else{$(i).append(l);if(!Pref.HideEmptySubP){u=$("<li/>");u.append("<h4>"+RES_NO_DATA+"</h4>");$(i).append(u)}$(i).show()}}}else{$(i).hide()}}$(i).listview("refresh")})}}function displayField(s,a,q,o,i){var h="",f=sugar_mod_fields[a][q],r=f.type,e=s[q]===undefined?"":s[q].value;if(r==="url"&&f.gen===1&&e===""){e=f.def}if((s[q]!==undefined)&&(e!=="")&&(e!==false)){if(q==="duration_hours"){h="<h4>"+s.duration_hours.value+"h&nbsp;"+s.duration_minutes.value+"m&nbsp;</h4>"}else{if(q==="duration_minutes"){}else{if(r==="url"){h=e.trim();if(h!==""){if(h==="http://"){h=""}else{h=(h.substring(0,4)!=="http"?("http://"):"")+h;if(f.gen===1){var l=h.replace(regFindField,"$2");h=h.replace(regFindField,"$1")+s[l].value+h.replace(regFindField,"$3")}e=h}}}else{if(r==="html"||q==="description_html"){h=e}else{h='<h4 style="white-space:normal;">'+display_value(a,q,e)+"</h4>"}}}}}else{if(r==="html"){h=display_default(a,q)}}if(h!==""&&h!==false){var p,n,m;if(i&&o!==""){$(o).append('<li data-role="list-divider">'+RES_MORE_INFORMATION_LABEL+"</li>")}if(q==="duration_hours"){n="<li><p>"+RES_DURATION_LABEL+"</p>"+h+"</li>"}else{if(q==="duration_minutes"){}}n=$("<li/>");switch(r){case"relate":case"parent":var g,k;k=f.id_name;if(r==="relate"){g=f.module}else{g=s[f.id_type].value}if(ViewPages.indexOf(g)===-1||s[k]===undefined){n="<li><p>"+display_label(a,q)+"</p>"+h+"</li>"}else{m="<p>"+display_label(a,q)+"</p><h4>"+(r==="parent"?"<img style='top:50%;margin-top:-9px;' src='"+Beans[g].icon32+"' width='16' height='16'/>&nbsp;":"")+e+"</h4>";p=$("<a/>",{href:"#","data-identity":s[k].value,click:function(){Beans[g].CurrentId=$(this).data("identity");if(g===a){Beans[g].ViewDetails()}else{$.mobile.changePage("#"+g+"DetailsPage")}}});p.append(m);n.append(p)}break;case"url":m="<h4>"+e+"</h4>";p=CreateExtLink(h);p.append("<p>"+display_label(a,q)+"</p>");p.append(m);n.append(p);break;case"file":m="<h4>"+e+"</h4>";p=CreateDownloadLink(a,Beans[a].CurrentId,s);p.append('<img class="ui-li-icon ui-li-thumb" alt="Attachment" src="images/attachment.gif">');p.append(m);n.append(p);break;case"email":m="<h4>"+e+"</h4>";p=$("<a/>",{href:"mailto:"+e,rel:"external",style:"text-decoration:none;color:#444;"});p.append("<p>"+display_label(a,q)+"</p>");p.append(m);n.append(p);break;case"phone":m="";if(q.indexOf("mobile")!==-1){m=" data-icon='chat' data-split-theme='d'"}n=$("<li"+m+"/>");var j=cleanup_phone(e);m="<h4>"+e+"</h4>";p=$("<a/>",{href:"tel:"+j,rel:"external",style:"text-decoration:none;color:#444;",click:function(){LogCall(a,Beans[a].CurrentId,(s.account_id?s.account_id.value:""),(a!=="Calls"||(s.status&&s.status==="Held")));return true}});p.append("<p>"+display_label(a,q)+"</p>");p.append(m);n.append(p);if(q.indexOf("mobile")!==-1){n.append($("<a/>",{href:"sms:"+j,rel:"external",title:"SMS",style:"text-decoration:none;color:#444;"}))}break;default:n="<li><p>"+display_label(a,q)+"</p>"+h+"</li>";break}if(o===""){return n}else{$(o).append(n);return true}}else{return false}}function displayCustom(j,b,a,g,i){var e=(i===undefined?true:i),c=false;i=e;for(var h in a){if(a[h].substring(0,4)==="$ADD"){var f=a[h].substring(4);display_address(j,b,f,g);continue}var d=displayField(j,b,a[h],g,e);if(d&&!c){c=true}e=i&&!c}}function createLink(a,b){return $("<a/>",{href:"#","data-identity":b,click:function(){Beans[a].CurrentId=$(this).data("identity");$.mobile.changePage("#"+a+"DetailsPage")}})}function AddLinkWithIcon(b,j,i,u,m,e,g,k){e="#Phone"+e;var s=getPhoneValues(u,m,b),r=s.length>0,p=((b==="Notes")&&u.filename!==undefined&&u.filename.value!=="")||((b==="Documents")&&u.document_name!==undefined&&u.document_name.value!==""),l=Beans[b].CustomListStyle(u,g),o=(r?" data-icon='phone' data-split-theme='d'":(p?" data-icon='link' data-split-theme='d'":"")),n=(i===""?Beans[b].DisplaySubpanelElt(u):i),q=$("<li "+o+(l===""?"":("style='"+l+"'"))+"/>"),t=$("<a/>",{href:"#"});t.click({id:j,module:b},function(d){Beans[d.data.module].CurrentId=d.data.id;if(d.data.module===k){Beans[d.data.module].ViewDetails()}else{$.mobile.changePage("#"+d.data.module+"DetailsPage")}});if(g){q.addClass(b+"SIcon");q.css({"padding-left":"20px"})}t.append(n);q.append(t);if(r){var c={href:e,"data-rel":"popup",style:l};if(l!==""){c.style=l}var h=$("<a/>",c),a=(b!=="Calls"||(u.status&&u.status.value==="Held"));h.click({phones:s,cur:u,lnk_mod:b,page:e,newcall:a},function(d){OpenPhoneList(d.data.phones,d.data.cur,d.data.lnk_mod,d.data.page,d.data.newcall)});q.append(h)}else{if(p){q.append(CreateDownloadLink(b,j,u,l))}}return q}function GetActivitiesList(b){AlertPopup(RES_UNAVAILABLE)}function SugarCrmDelete(a,b){AlertPopup(RES_UNAVAILABLE)}function setCookie(a,d,b){if(mobile_app){localStorage.setItem(a,d);return}var e=new Date();e.setDate(e.getDate()+b);var c=escape(d)+((b===null)?"":"; expires="+e.toUTCString());document.cookie=a+"="+c}function getCookie(b){if(mobile_app){var d=localStorage.getItem(b);if(d===0){d="0"}else{if(d===1){d="1"}}return d}var c,a,f,e=document.cookie.split(";");for(c=0;c<e.length;c++){a=e[c].substr(0,e[c].indexOf("="));f=e[c].substr(e[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return unescape(f)}}return""}(function(i){var n=function(c,a){var f,m,d,e,b;d=c&2147483648;e=a&2147483648;f=c&1073741824;m=a&1073741824;b=(c&1073741823)+(a&1073741823);if(f&m){return b^2147483648^d^e}return f|m?b&1073741824?b^3221225472^d^e:b^1073741824^d^e:b^d^e},h=function(c,a,f,m,d,e,b){c=n(c,n(n(a&f|~a&m,d),b));return n(c<<e|c>>>32-e,a)},l=function(c,a,f,m,d,e,b){c=n(c,n(n(a&m|f&~m,d),b));return n(c<<e|c>>>32-e,a)},j=function(c,a,f,m,d,e,b){c=n(c,n(n(a^f^m,d),b));return n(c<<e|c>>>32-e,a)},k=function(c,a,f,m,d,e,b){c=n(c,n(n(f^(a|~m),d),b));return n(c<<e|c>>>32-e,a)},g=function(b){var a="",c="",d;for(d=0;d<=3;d++){c=b>>>d*8&255;c="0"+c.toString(16);a+=c.substr(c.length-2,2)}return a};i.extend({md5:function(t){var r=[],c,d,a,b,s,m,f,e;r=t;r=r.replace(/\x0d\x0a/g,"\n");t="";for(c=0;c<r.length;c++){d=r.charCodeAt(c);if(d<128){t+=String.fromCharCode(d)}else{if(d>127&&d<2048){t+=String.fromCharCode(d>>6|192)}else{t+=String.fromCharCode(d>>12|224);t+=String.fromCharCode(d>>6&63|128)}t+=String.fromCharCode(d&63|128)}}r=t=t;t=r.length;c=t+8;d=((c-c%64)/64+1)*16;a=Array(d-1);for(s=b=0;s<t;){c=(s-s%4)/4;b=s%4*8;a[c]|=r.charCodeAt(s)<<b;s++}c=(s-s%4)/4;b=s%4*8;a[c]|=128<<b;a[d-2]=t<<3;a[d-1]=t>>>29;r=a;s=1732584193;m=4023233417;f=2562383102;e=271733878;for(t=0;t<r.length;t+=16){c=s;d=m;a=f;b=e;s=h(s,m,f,e,r[t+0],7,3614090360);e=h(e,s,m,f,r[t+1],12,3905402710);f=h(f,e,s,m,r[t+2],17,606105819);m=h(m,f,e,s,r[t+3],22,3250441966);s=h(s,m,f,e,r[t+4],7,4118548399);e=h(e,s,m,f,r[t+5],12,1200080426);f=h(f,e,s,m,r[t+6],17,2821735955);m=h(m,f,e,s,r[t+7],22,4249261313);s=h(s,m,f,e,r[t+8],7,1770035416);e=h(e,s,m,f,r[t+9],12,2336552879);f=h(f,e,s,m,r[t+10],17,4294925233);m=h(m,f,e,s,r[t+11],22,2304563134);s=h(s,m,f,e,r[t+12],7,1804603682);e=h(e,s,m,f,r[t+13],12,4254626195);f=h(f,e,s,m,r[t+14],17,2792965006);m=h(m,f,e,s,r[t+15],22,1236535329);s=l(s,m,f,e,r[t+1],5,4129170786);e=l(e,s,m,f,r[t+6],9,3225465664);f=l(f,e,s,m,r[t+11],14,643717713);m=l(m,f,e,s,r[t+0],20,3921069994);s=l(s,m,f,e,r[t+5],5,3593408605);e=l(e,s,m,f,r[t+10],9,38016083);f=l(f,e,s,m,r[t+15],14,3634488961);m=l(m,f,e,s,r[t+4],20,3889429448);s=l(s,m,f,e,r[t+9],5,568446438);e=l(e,s,m,f,r[t+14],9,3275163606);f=l(f,e,s,m,r[t+3],14,4107603335);m=l(m,f,e,s,r[t+8],20,1163531501);s=l(s,m,f,e,r[t+13],5,2850285829);e=l(e,s,m,f,r[t+2],9,4243563512);f=l(f,e,s,m,r[t+7],14,1735328473);m=l(m,f,e,s,r[t+12],20,2368359562);s=j(s,m,f,e,r[t+5],4,4294588738);e=j(e,s,m,f,r[t+8],11,2272392833);f=j(f,e,s,m,r[t+11],16,1839030562);m=j(m,f,e,s,r[t+14],23,4259657740);s=j(s,m,f,e,r[t+1],4,2763975236);e=j(e,s,m,f,r[t+4],11,1272893353);f=j(f,e,s,m,r[t+7],16,4139469664);m=j(m,f,e,s,r[t+10],23,3200236656);s=j(s,m,f,e,r[t+13],4,681279174);e=j(e,s,m,f,r[t+0],11,3936430074);f=j(f,e,s,m,r[t+3],16,3572445317);m=j(m,f,e,s,r[t+6],23,76029189);s=j(s,m,f,e,r[t+9],4,3654602809);e=j(e,s,m,f,r[t+12],11,3873151461);f=j(f,e,s,m,r[t+15],16,530742520);m=j(m,f,e,s,r[t+2],23,3299628645);s=k(s,m,f,e,r[t+0],6,4096336452);e=k(e,s,m,f,r[t+7],10,1126891415);f=k(f,e,s,m,r[t+14],15,2878612391);m=k(m,f,e,s,r[t+5],21,4237533241);s=k(s,m,f,e,r[t+12],6,1700485571);e=k(e,s,m,f,r[t+3],10,2399980690);f=k(f,e,s,m,r[t+10],15,4293915773);m=k(m,f,e,s,r[t+1],21,2240044497);s=k(s,m,f,e,r[t+8],6,1873313359);e=k(e,s,m,f,r[t+15],10,4264355552);f=k(f,e,s,m,r[t+6],15,2734768916);m=k(m,f,e,s,r[t+13],21,1309151649);s=k(s,m,f,e,r[t+4],6,4149444226);e=k(e,s,m,f,r[t+11],10,3174756917);f=k(f,e,s,m,r[t+2],15,718787259);m=k(m,f,e,s,r[t+9],21,3951481745);s=n(s,c);m=n(m,d);f=n(f,a);e=n(e,b)}return(g(s)+g(m)+g(f)+g(e)).toLowerCase()}})})(jQuery);function getFromTemplate(b,k,h){var e=h,c=e.match(/\{[-\(\[\s]?\w+[\)\]]?\}/gi);for(var d in c){var j=c[d],m="",f="",n="",g;j=j.substr(1,j.length-2);g=j.substr(0,1);if(g=="-"){f=" - "}else{if(g==" "){f=" "}else{if(g=="("){f=" (";n=")"}else{if(g=="["){f=" [";n="]"}}}}if(f.length>0){j=j=j.substr(1,j.length-(n.length+1))}if(k[j]!==undefined&&k[j].value!==undefined){m=f+display_value(b,j,k[j].value)+n}e=e.replace(c[d],m)}return e}function ShowBeansList(a,h,d,b,f,e,g,c,j){if(!init_done){MobileInit();return}var i=Beans[a],k=$("#"+e);if(h!==""){$("#"+e+" li").remove();k.append('<li data-theme="d" style="background: #dddddd">'+h+"</li>")}else{$("#"+e+" li:gt(0)").remove()}QCRM.get_entry_list(a,d,i.ListFieldsToSelect(),i.link_phone_fields,c,b,f,function(q){if(q&&q.entry_list!==undefined){if(q.next_offset===0||q.result_count===0){k.append("<li>"+RES_NO_MORE_RECORDS+"</li>")}else{var l=0,o=q.entry_list.length;for(l=0;l<o;l++){var p=q.entry_list[l],m=p.module_name;var n=AddLinkWithIcon(m,p.id,"",p.name_value_list,(q.relationship_list&&q.relationship_list[l]&&q.relationship_list[l].link_list)?q.relationship_list[l].link_list:[],g,false,"");k.append(n)}}k.listview().listview("refresh");j({next_offset:q.next_offset,result_count:q.result_count,total_count:(q.total_count!==undefined?q.total_count:false)})}else{j({next_offset:0,result_count:0,total_count:false})}})}function SugarBean(a,b,c){if(c===undefined){c=false}this.Person=false;this.Fields=[];this.link_fields="";this.link_phone_fields="";this.name=a;this.table=b;this.Predefined=[];this.HomeIcon=true;this.LastViewed=true;this.CurrentId="";this.CurrentName="";this.CurrentData={};this.CurrentParentId="";this.CurrentParentType="";this.CurrentParentName="";this.CurrentOffset=0;this.PrevOffset=0;this.NextOffset=0;this.CurrentSearch=false;this.CurrentSearchValues=false;this.CurrentSearchOrder=false;this.SearchName=b+".name";this.SearchFields=[];this.OrderBy="";this.SyncOrderBy="date_entered desc";this.TitleTpl="{name}";this.ListFields=["name"];this.ListViewTpl="<h4>{name}</h4>";this.CustomListViewTpl=false;this.TitleFields=["name"];this.AdditionalFields=[];this.PhoneFields=[];this.EditExcluded=[];this.Links={};this.CustomLinks=false;this.CustomListFields=[];this.CustomListStyle=function(f,e){return""};this.AddBtn=false;this.icon=function(){if(QCRM.OffLine||c=="none"){return froot+"images/icon_"+(c===false?a:"custom")}else{return ServerAddress+(c?"custom/":"")+"themes/default/images/icon_"+a}};this.icon32=this.icon()+"_32.gif";this.access=((mobile_edition==="Pro")?(typeof sugar_mod==="undefined"?"edit":"none"):"view");this.acl={list:true,view:true,edit:true,del:true};this.Enabled=function(){var e=this.name;return(QCRM.beans.indexOf(e)!==-1&&this.access!=="none"&&(!QCRM.OffLine||Pref.SyncModules[e].sync!=="None")&&Pref.Disabled.indexOf(e)===-1)};this.toUpdate=false;this.toUpdateFields={};this.link_name_to_fields_relate="";var d=this;this.CreateHook=function(){};this.StoreFieldsSaved=[];this.StoreFields=function(l,g){var e;if(this.StoreFieldsSaved.length>0){e=this.StoreFieldsSaved}else{var m=["assigned_user_id","assigned_user_name","date_entered","date_modified"];e=this.AllFields().concat(this.RelateFields(true));for(var j in m){if(e.indexOf(m[j])===-1){e.push(m[j])}}this.StoreFieldsSaved=e}this.CurrentData={};for(var h in e){var k=e[h];if(l[k]){this.CurrentData[k]={name:k,value:l[k].value}}}this.CurrentName=g};this.AllFieldsSaved=[];this.AllFields=function(){if(this.AllFieldsSaved.length>0){return this.AllFieldsSaved}var g=this.TitleFields.concat(this.Fields),e;if(this.Addresses!==undefined){for(var k in d.Addresses){var i=d.Addresses[k];for(var j in AddFields){g.push(i+"_address_"+AddFields[j])}}}e=this.AdditionalFields.concat(this.SearchFields);for(var k in e){var h=e[k];if(h.substring(0,4)==="$ADD"){var i=h.substring(4);for(var j in AddFields){g.push(i+"_address_"+AddFields[j])}}else{if(g.indexOf(h)===-1){g.push(h)}}}this.AllFieldsSaved=g;return g};this.AllOrderFields=function(){var e=this.AllFields(),f=[];for(var h in e){if(sugar_mod_fields[this.name][e[h]]===undefined){continue}var g=sugar_mod_fields[this.name][e[h]].type;if(g!=="relate"&&g!=="email"&&g!=="bool"&&g!=="parent"){f.push(e[h])}}return f};this.HasAddress=function(){if(this.Addresses!==undefined&&this.Addresses[0]!==undefined){return true}for(var g in this.AdditionalFields){var e=this.AdditionalFields[g];if(e.substring(0,4)==="$ADD"){return true}}return false};this.RelateFields=function(h){var k,l,e=this.AllFields().slice(0);if(h){if(this.DefaultRelate){k=this.DefaultRelate.field;if(e.indexOf(k)===-1){e.push(k)}}if(this.DefaultParent){k=this.DefaultParent.field;if(e.indexOf(k)===-1){e.push(k)}}}var g=[];for(var j in e){k=e[j];l=sugar_mod_fields[this.name][k];if(l===undefined){}else{if(l.type==="relate"){if(l.id_name!==undefined&&l.id_name!==k){g.push(l.id_name)}}else{if(l.type==="parent"){g.push(l.id_name);g.push(l.id_type)}}}}return g};this.ListFieldsToSelect=function(){return'["'+this.ListFields.concat(["id"]).join('","')+'"]'};this.DisplaySubpanelElt=function(e){return getFromTemplate(this.name,e,this.ListViewTpl)};this.DisplaySubpanelRecord=function(h,f,e,g){return AddLinkWithIcon(this.name,h,"",f,[],e,false,g)};this.DisplayTitle=function(e){return getFromTemplate(this.name,e,this.TitleTpl)};this.DisplaySubpanelFilter=function(e){return""};this.ViewDetailsHook=function(e){};this.ViewDetailsHdrHook=function(e){};this.ViewDetailsFtrHook=function(e){};this.ViewDetails=function(){var f=this;function e(h,g,i){if(h==="deleted"){AlertPopup(sugar_app_strings.ERROR_NO_RECORD)}else{if(h==="Access Denied"){AlertPopup(RES_ACCESS_DENIED_MSG)}else{AlertPopup(sugar_app_strings.ERROR_NO_RECORD)}}RemoveFromLastviewed(g,i);f.CurrentId=""}if(!init_done){MobileInit();return}if(this.CurrentId==""){return}$.mobile.showPageLoadingMsg();$("#"+this.name+"DetailsList li").remove();$("#"+this.name+"NameH1").html(sugar_app_list_strings.moduleListSingular[this.name]);QCRM.get_entry(this.name,this.CurrentId,function(i){if(i){if(i.name!==undefined){e(i.name,d.name,i.id,d.CurrentId);return}else{if(i.entry_list!==undefined&&i.entry_list[0]!==undefined){i=i.entry_list[0];edit_data=i.name_value_list;edit_data.module=d.name;if(edit_data[1]!==undefined&&edit_data[1].name!==undefined){e(edit_data[1].name,d.name,i.id,d.CurrentId);return}var k=d.DisplayTitle(edit_data);d.StoreFields(edit_data,k);$("#"+d.name+"NameH1").html(k);if(d.LastViewed){PushViewed(d.name,d.CurrentId,k)}d.ViewDetailsHook(edit_data);d.ViewDetailsHdrHook(edit_data);var g="#"+d.name+"DetailsList";$(g).append('<li data-role="list-divider">'+RES_OVERVIEW_LABEL+"</li>");if(typeof d.ViewDetailsCustom==="function"){d.ViewDetailsCustom(edit_data,g)}else{d.DisplayStd(i.name_value_list);if(d.Addresses!==undefined&&d.Addresses[0]!==undefined){display_address(edit_data,d.name,d.Addresses[0],g)}}d.ViewDetailsFtrHook(edit_data,g);$(g).listview("refresh");var j=d.CustomLinks||d.Links;for(var l in j){var h=(d.CustomLinks&&d.CustomLinks[0]!==undefined)?j[l]:l;getRelatedList(d.name,h)}}}}});$.mobile.hidePageLoadingMsg()};this.DisplayStd=function(e){displayCustom(e,this.name,this.Fields,"#"+this.name+"DetailsList",false)};this.Edit=function(f,g){var e=(this.CurrentId==="");AlertPopup(RES_UNAVAILABLE)};this.Create=function(e,f){return this.Edit(e,f)};this.DefaultRelate=false;this.DefaultParent=false;this.SaveFields=function(e){return""}}SugarBean.prototype.GetList=function(b){if(!init_done){MobileInit();return}var d="",e=this.name,i=this,c="#"+e+"ListDiv",g=$(c),h=sugar_app_list_strings.moduleList[i.name],f=$("#"+e+"ListPageTitle");d=get_where(e,this.CurrentSearchValues);if(d!==this.CurrentSearch){b=0;this.NextOffset=0;this.PrevOffset=0;this.CurrentOffset=0}this.CurrentSearch=d;$.mobile.showPageLoadingMsg();$(c+" li").remove();this.CurrentOffset=b;enableButton(e+"PreviousBtn",b>0);QCRM.get_entry_list(e,d,this.ListFieldsToSelect(),this.link_phone_fields,b,RowsPerPage,(this.CurrentSearchOrder&&this.CurrentSearchOrder!=="")?this.CurrentSearchOrder:this.OrderBy,function(o){if(o){if(o!==undefined&&o.entry_list!==undefined){if(o.result_count===0){}else{if(o.next_offset===0){i.CurrentOffset=0}}if(o.next_offset===0||o.result_count===0){g.append("<li>"+RES_NO_MORE_RECORDS+"</li>")}else{if(o.total_count!==undefined){var n=1+i.CurrentOffset;var m=i.CurrentOffset+o.result_count;h+=" ("+n.toString()+"-"+m.toString()+"/"+o.total_count.toString()+")";enableButton(i.name+"NextBtn",o.next_offset<o.total_count)}var a=0;for(a=0;a<o.entry_list.length;a++){var l=o.entry_list[a],j=l.module_name;var k=AddLinkWithIcon(j,l.id,"",l.name_value_list,(o.relationship_list&&o.relationship_list[a]&&o.relationship_list[a].link_list)?o.relationship_list[a].link_list:[],i.name+"ListPage",false,"");g.append(k)}i.NextOffset=o.next_offset;i.PrevOffset=b-RowsPerPage;if(i.PrevOffset<0){i.PrevOffset=0}}f.text(h);g.listview("refresh")}}$.mobile.hidePageLoadingMsg()})};SugarBean.prototype.InitEditForm=function(){};function SugarSimpleBean(a,b,c,d){this.name=a;this.table=b;this.DefValue="";this.query=c;this.OrderBy=d===undefined?"":d;this.Fields=["name"];this.link_fields="";this.List={};this.Columns=[];this.ListFields=["name"];this.ListViewTpl="<h4>{name}</h4>";this.Enabled=function(){return true};this.ListFieldsToSelect=function(){return'["'+this.ListFields.concat(["id"]).join('","')+'"]'};this.DisplaySubpanelFilter=function(e){return""};this.DisplaySubpanelElt=function(e){return getFromTemplate(this.name,e,this.ListViewTpl)};this.DisplayTitle=function(e){return getFromTemplate(this.name,e,this.TitleTpl)};this.AfterLoad=function(e){}}SugarSimpleBean.prototype.Load=function(b){var a=this;QCRM.get_S_entry_list(this.name,this.query,this.Fields,this.link_fields,0,100,this.OrderBy,function(k){if(k){if(k!=undefined&&k.entry_list!=undefined){var e=0;for(e=0;e<k.entry_list.length;e++){var j=k.entry_list[e],i="";for(var h=0;h<a.Fields.length;h++){var g=a.Fields[h];if(i!==""){i+=" "}if(j.name_value_list[g]!==undefined){i+=j.name_value_list[g].value}}a.List[j.id]=i}b(k)}}})};QCRM.SavedSearch=[];QCRM.enableBeans=function(g){PagesCreated=true;QCRM.beans=g;var a=[],e;if(typeof sugar_mod!=="undefined"){for(e in g){var c=g[e];if(Beans[c]===undefined){a.push(c);Beans[c]=new SugarBean(c,sugar_mod[c].table,sugar_mod[c].custom);if(sugar_mod[c].type==="person"){Beans[c].TitleFields=["first_name","last_name"];Beans[c].ListFields=["first_name","last_name"];Beans[c].OrderBy="last_name";Beans[c].TitleTpl="{first_name} {last_name}";Beans[c].ListViewTpl="<h4>{first_name} {last_name}</h4>";Beans[c].SearchName=toDBConcatName(sugar_mod[c].table+".first_name",sugar_mod[c].table+".last_name")}}Beans[c].access="edit";Beans[c].Person=(sugar_mod[c].type==="person")}for(e in g){var c=g[e];if(sugar_mod[c]&&sugar_mod[c].links!==undefined){for(var h in sugar_mod[c].links){if(Beans[c].Links[h]===undefined){var b=sugar_mod_fields[c];var i=sugar_mod[c].links[h],f=false,d;if((typeof i)!=="string"){i=sugar_mod[c].links[h].module;f=sugar_mod[c].links[h].id_name;for(d in b){if(b[d].type==="relate"){if(b[d].id_name===f){sugar_mod_fields[c][d].ass_link=h}}}}Beans[c].Links[h]={module:i,create:(i!=="Accounts"&&i!=="Documents"),select:true,id_name:f}}}}}}for(e in g.reverse()){var c=g[e];if(c!==undefined&&sugar_app_list_strings.moduleList[c]!==undefined){var j=sugar_app_list_strings.moduleList[c];if(j.length>12&&j.indexOf(" ")===-1){j='<span style="font-size: smaller;">'+j+"<span>"}$("<style type='text/css'> ."+c+"Icon{background-image:url('"+Beans[c].icon32+"');background-repeat: no-repeat;} </style>").appendTo("head");$("<style type='text/css'> ."+c+"SIcon{background-image:url('"+Beans[c].icon32+"');background-repeat: no-repeat;background-size: 16px 16px;font-size: 0.8em;background-position: 3px 50%;} </style>").appendTo("head");$("#HomeMenu").prepend('<li class="IconContainer" id="Icon'+c+'"><a href="#'+c+'Search"><div class="HomeIcon '+c+'Icon"/><div>'+j+"</div></a></li>")}}g.reverse();for(e in g){if(Beans[g[e]]!==undefined&&sugar_app_list_strings.moduleList[g[e]]!==undefined){var c=g[e];$.mobile.pageContainer.append('<div id="'+c+'Search" data-role="page" data-theme="b"><div data-role="header" data-theme="b"><h1 id="'+c+'SearchTitle"/></div><div data-role="content"><div data-role="fieldcontain"><label for="Settings'+c+'Search">'+RES_NAME_LABEL+'</label><input id="Settings'+c+'Search" type="text" data-clear-btn="true"/></div><div id="'+c+'DivMoreOptions" data-role="collapsible"><h3>'+RES_OPTIONS+'</h3><div name="'+c+'MyItemsOption" data-role="fieldcontain"><fieldset data-role="controlgroup" data-mini="true"><input type="checkbox" name="'+c+'MyItems" id="'+c+'MyItems" class="custom" data-theme="c" /><label for="'+c+'MyItems">'+sugar_app_strings.LBL_CURRENT_USER_FILTER+'</label></fieldset></div></div><div id="'+c+'SS" style="display: none;"></div><div id="'+c+'SButtons" style="margin:0 auto; margin-left:auto; margin-right:auto; align:center; text-align:center;"><a id="'+c+'SClearBtn" href="#" data-role="button" data-mini="true" data-inline="true" data-theme="c">'+RES_CLEAR+'</a><a id="'+c+'SSearchBtn" href="#'+c+'ListPage" data-role="button" data-mini="true" data-inline="true">'+sugar_app_strings.LBL_SEARCH_BUTTON_LABEL+'</a><a id="'+c+'SSaveBtn" href="#" data-role="button" data-mini="true" data-inline="true" style="display:none;">'+sugar_app_strings.LBL_SAVE_BUTTON_LABEL+'</a></div><div data-role="footer" data-position="fixed" data-theme="a"><div data-role="navbar"><ul id="'+c+'SFtr"><li><a id="'+c+'SHomeBtn" href="#HomePage" data-role="button" data-icon="home" data-direction="reverse"/></li><li><a id="'+c+'SBackBtn" href="#" data-role="button" data-icon="back" data-rel="back"/></li><li><a id="'+c+'SAddBtn" href="#" data-role="button" data-icon="plus"></a></li><li><a id="'+c+'LastViewedBtn" href="#LastViewedListPage" data-role="button" data-icon="page" data-direction="reverse"/></li><li><a id="'+c+'AllModulesBtn" href="#AllModulesListPage" data-role="button" data-icon="grid" data-direction="reverse"/></li></ul></div></div></div>');$("#"+c+"SClearBtn").click({val:c},function(k){clearSearchValues(k.data.val)});$("#"+c+"SAddBtn").click({val:c},function(k){Beans[k.data.val].Create()});$("#"+c+"SSearchBtn").click({val:c},function(k){StartSearch(k.data.val)});$.mobile.pageContainer.append('<div id="'+c+'ListPage" data-role="page" data-theme="c"><div data-role="header" data-theme="b"><h1 id="'+c+'ListPageTitle"/></div><div data-role="content"><ul id="'+c+'ListDiv" data-role="listview" data-split-theme="c" data-filter="false" /></div><div data-role="footer" data-position="fixed" data-theme="a"><div data-role="navbar"><ul id="'+c+'LFtr"><li><a id="'+c+'PreviousBtn" href="#" data-role="button" data-icon="arrow-l"></a></li><li><a id="'+c+'ListPageHomeBtn" href="#HomePage" data-role="button" data-icon="home" data-direction="reverse" ></a></li><li><a id="'+c+'LBackBtn" href="#" data-role="button" data-icon="back" data-rel="back"/></li><li><a id="'+c+'ListPageAddBtn" href="#" data-role="button" data-icon="plus"></a></li><li><a id="'+c+'NextBtn" href="#" data-role="button" data-icon="arrow-r"></a></li></ul></div></div></div>');$("#"+c+"PreviousBtn").click({val:c},function(k){Beans[k.data.val].GetList(Beans[k.data.val].PrevOffset)});$("#"+c+"NextBtn").click({val:c},function(k){Beans[k.data.val].GetList(Beans[k.data.val].NextOffset)});$("#"+c+"ListPageAddBtn").click({val:c},function(k){Beans[k.data.val].Create()});$.mobile.pageContainer.append('<div id="'+c+'DetailsPage" data-role="page" data-theme="c"><div data-role="header" data-theme="b"><h1 id="'+c+'NameH1"/></div><div data-role="content"><div id="'+c+'DetailsBtn"></div><div id="'+c+'DetailsHdr"></div><div><ul id="'+c+'DetailsList" data-role="listview" data-split-theme="c" data-inset="true" /></div><div id="'+c+'DetailsFtr"></div><div id="'+c+'Links"/></div><div data-role="footer" data-position="fixed" data-theme="a"><div data-role="navbar"><ul><li><a id="'+c+'HomeBtn" href="#HomePage" data-role="button" data-icon="home" data-direction="reverse"/></li><li><a id="'+c+'BackBtn" href="#" data-role="button" data-icon="back" data-rel="back"/></li><li><a id="'+c+'SearchBtn" href="#'+c+'Search" data-role="button" data-icon="search" data-direction="reverse"/></li><li><a id="'+c+'DelBtn" href="#" data-role="button" data-icon="trash"/></li><li><a id="'+c+'EditBtn" href="#" data-role="button" data-icon="edit"/></li></ul></div></div></div>');$("#"+c+"EditBtn").click({val:c},function(k){Beans[k.data.val].Edit()});$("#"+c+"DelBtn").click({val:c},function(k){SugarCrmDelete(k.data.val,Beans[k.data.val].CurrentId)});if(Beans[c].Predefined.indexOf("Edit")==-1){$.mobile.pageContainer.append('<div id="Edit'+c+'" data-role="page" data-theme="b"><div data-role="header" data-theme="b"> <h1 id="Edit'+c+'Title"/> <a href="#" data-role="button" data-rel="back" data-theme="c">'+sugar_app_strings.LBL_CANCEL_BUTTON_LABEL+'</a> <a id="Edit'+c+'ConfirmTopBtn" href="#" data-role="button"  data-inline="true" class="ui-btn-right" data-theme="b">'+sugar_app_strings.LBL_SAVE_BUTTON_LABEL+'</a></div><div data-role="content"> <div id="Edit'+c+'Std"/><div id="Edit'+c+'Additional"/><br /> <div style="margin:0 auto; margin-left:auto; margin-right:auto; align:center; text-align:center;">  <a id="Edit'+c+'CancelBottomBtn" href="#" data-role="button" data-rel="back" data-inline="true" data-theme="c">'+sugar_app_strings.LBL_CANCEL_BUTTON_LABEL+'</a>  <a id="Edit'+c+'ConfirmBottomBtn" href="#" data-role="button" data-inline="true" >'+sugar_app_strings.LBL_SAVE_BUTTON_LABEL+"</a> </div></div></div>");$("#Edit"+c+"ConfirmTopBtn").click({val:c},function(k){Beans[k.data.val].Save()});$("#Edit"+c+"ConfirmBottomBtn").click({val:c},function(k){Beans[k.data.val].Save()})}}}for(e in g){if(Beans[g[e]]!==undefined&&sugar_app_list_strings.moduleList[g[e]]!==undefined){QuickCRMAddDetailsPage(g[e]);QuickCRMAddListPage(g[e])}}};QCRM.setProfile=function(){if(QCRM.Profiles!=undefined&&CurrentProfileId!==""&&QCRM.Profiles[CurrentProfileId]!=undefined){$.each(QCRM.Profiles[CurrentProfileId],function(a,b){if(b.fields!==undefined&&b.fields.length>0){Beans[a].AdditionalFields=b.fields}if(b.search!==undefined&&b.search.length>0){Beans[a].SearchFields=b.search}if(b.links!==undefined&&b.links.length>0){Beans[a].CustomLinks=b.links}})}};function ComputeFieldsToUpdate(e){var j=Beans[e],k={},b=[],a=false,c=sugar_mod_fields[e];for(var h in j.Links){var d=j.Links[h].module;if(Beans[d]!==undefined&&Beans[d].Enabled()){var i;if(Beans[d].Person){i={name:h,value:["id","first_name","last_name"]}}else{i={name:h,value:["id","name"]}}b.push(i);if(Beans[e].Links[h].id_name){var g=j.Links[h].id_name,f;for(fld in c){if(c[fld].type==="relate"&&c[fld].id_name===g){f=fld;k[h]={id_name:g,id_value:f,person:Beans[d].Person};a=true;break}}}}else{if(SimpleBeans[d]!==undefined){b.push({name:h,value:["id"]})}}}Beans[e].toUpdate=a;Beans[e].toUpdateFields=k;Beans[e].link_fields=JSON.stringify(b)}function ComputePhoneFields(c){var a=Beans[c],e=[],b=sugar_mod_fields[c],d=false;for(var h in a.Links){var g=a.Links[h].module;if(Beans[g]!==undefined&&Beans[g].Enabled()&&Beans[g].PhoneFields.length>0){var f;if(Beans[g].Person){f={name:h,value:["id","first_name","last_name"]}}else{f={name:h,value:["id","name"]}}f.value=f.value.concat(Beans[g].PhoneFields);e.push(f);d=true}}if(d){Beans[c].link_phone_fields=JSON.stringify(e)}}Beans.Accounts=new SugarBean("Accounts","accounts");Beans.Accounts.ListFields=["name","billing_address_city","billing_address_state"];Beans.Accounts.OrderBy="name";Beans.Accounts.ListViewTpl="<h4>{name}</h4><p>{billing_address_city} {billing_address_state}</p>";Beans.Accounts.Links={contacts:{module:"Contacts",create:true,select:false},opportunities:{module:"Opportunities",create:true,select:false},calls:{module:"Calls",create:true,select:false},meetings:{module:"Meetings",create:true,select:false},tasks:{module:"Tasks",create:true,select:false},leads:{module:"Leads",create:false,select:false},cases:{module:"Cases",create:true,select:false},notes:{module:"Notes",create:true,select:false}};Beans.Contacts=new SugarBean("Contacts","contacts");Beans.Contacts.ListFields=["first_name","last_name","account_name","account_id","title"];Beans.Contacts.TitleFields=["first_name","last_name"];Beans.Contacts.OrderBy="last_name";Beans.Contacts.Person=true;Beans.Contacts.TitleTpl="{first_name} {last_name}";Beans.Contacts.ListViewTpl="<h4>{first_name} {last_name}</h4><p>{title} {account_name}</p>";Beans.Contacts.SearchName=toDBConcatName("contacts.first_name","contacts.last_name");Beans.Contacts.Links={calls:{module:"Calls",create:true,select:false},meetings:{module:"Meetings",create:true,select:false},tasks:{module:"Tasks",create:true,select:false},opportunities:{module:"Opportunities",create:true,select:false},cases:{module:"Cases",create:true,select:false},notes:{module:"Notes",create:true,select:false}};Beans.Contacts.ViewDetailsFtrHook=function(b,a){if(b.account_id!==undefined&&b.account_id.value!==undefined){this.CurrentParentId=b.account_id.value;this.CurrentParentName=b.account_name.value;this.CurrentParentType="Accounts"}else{this.CurrentParentId="";this.CurrentParentName="";this.CurrentParentType=""}};Beans.Leads=new SugarBean("Leads","leads");Beans.Leads.ListFields=["first_name","last_name","title","account_name"];Beans.Leads.TitleFields=["first_name","last_name"];Beans.Leads.OrderBy="last_name";Beans.Leads.TitleTpl="{first_name} {last_name}";Beans.Leads.Person=true;Beans.Leads.ListViewTpl="<h4>{first_name} {last_name}</h4><p>{account_name}</p>";Beans.Leads.SearchName=toDBConcatName("leads.first_name","leads.last_name");Beans.Leads.Links={calls:{module:"Calls",create:true,select:false},meetings:{module:"Meetings",create:true,select:false},tasks:{module:"Tasks",create:false,select:false},notes:{module:"Notes",create:true,select:false}};Beans.Leads.ViewDetailsHdrHook=function(d){if(d.status!==undefined&&d.status.value==="Converted"){var a=[];var b,c;if(d.contact_id!==undefined&&d.contact_id.value!==""){a.push({module:"Contacts",id:d.contact_id.value,name:Beans.Contacts.DisplayTitle(d)})}if(d.account_id!==undefined&&d.account_id.value!==""){a.push({module:"Accounts",id:d.account_id.value,name:d.account_name.value})}if(d.opportunity_id!==undefined&&d.opportunity_id.value!==""){a.push({module:"Opportunities",id:d.opportunity_id.value,name:d.opportunity_name.value})}if(a.length>0){$("#LeadsDetailsList").append('<li data-role="list-divider">'+sugar_app_list_strings.lead_status_dom.Converted+"</li>");GetBeansList(a,"LeadsDetailsList",false)}}};Beans.Opportunities=new SugarBean("Opportunities","opportunities");Beans.Opportunities.ListFields=["name","amount","account_name","currency_name","currency_symbol","sales_stage"];Beans.Opportunities.OrderBy="amount desc";Beans.Opportunities.SyncOrderBy="date_closed desc";Beans.Opportunities.ListViewTpl="<h4>{name}</h4><p>{account_name} {currency_symbol}{amount} {sales_stage}</p>";Beans.Opportunities.Links={contacts:{module:"Contacts",create:false,select:false},calls:{module:"Calls",create:true,select:false},meetings:{module:"Meetings",create:true,select:false},tasks:{module:"Tasks",create:true,select:false},leads:{module:"Leads",create:false,select:false},notes:{module:"Notes",create:true,select:false}};Beans.Calls=new SugarBean("Calls","calls");Beans.Calls.ListFields=["name","status","date_start"];Beans.Calls.OrderBy="date_start desc";Beans.Calls.SyncOrderBy="date_start desc";Beans.Calls.ListViewTpl="<h4>{name}</h4><p>{status} - {date_start}</p>";Beans.Calls.Links={contacts:{module:"Contacts",create:false,select:false},users:{module:"Users",create:false,select:false},leads:{module:"Leads",create:false,select:false},notes:{module:"Notes",create:true,select:false}};Beans.Meetings=new SugarBean("Meetings","meetings");Beans.Meetings.ListFields=["name","status","date_start"];Beans.Meetings.OrderBy="date_start desc";Beans.Meetings.SyncOrderBy="date_start desc";Beans.Meetings.ListViewTpl="<h4>{name}</h4><p>{status} - {date_start}</p>";Beans.Meetings.Links={contacts:{module:"Contacts",create:false,select:false},users:{module:"Users",create:false,select:false},leads:{module:"Leads",create:false,select:false},notes:{module:"Notes",create:true,select:false}};Beans.Tasks=new SugarBean("Tasks","tasks");Beans.Tasks.ListFields=["name","status","date_due"];Beans.Tasks.OrderBy="date_due desc";Beans.Tasks.ListViewTpl="<h4>{name}</h4><p>{status} - {date_due}</p>";Beans.Tasks.Links={contacts:{module:"Contacts",create:false,select:false},notes:{module:"Notes",create:true,select:false}};Beans.Cases=new SugarBean("Cases","cases");Beans.Cases.ListFields=["name","status","priority"];Beans.Cases.ListViewTpl="<h4>{name}</h4><p>{status} - {priority}</p>";Beans.Cases.Links={contacts:{module:"Contacts",create:false,select:false},notes:{module:"Notes",create:true,select:false}};Beans.Cases.EditExcluded=["case_number"];Beans.Project=new SugarBean("Project","project");Beans.Project.ListFields=["name","status","priority"];Beans.Project.ListViewTpl="<h4>{name}</h4><p>{status} - {priority}</p>";Beans.Project.Links={projecttask:{module:"ProjectTask",create:true,select:false},notes:{module:"Notes",create:true,select:false}};Beans.ProjectTask=new SugarBean("ProjectTask","project_task");Beans.ProjectTask.ListFields=["name","status","assigned_user_name"];Beans.ProjectTask.ListViewTpl="<h4>{name}</h4><p>{status} - {assigned_user_name}</p>";Beans.ProjectTask.Links={notes:{module:"Notes",create:true,select:false}};Beans.Documents=new SugarBean("Documents","documents");Beans.Documents.HomeIcon=false;Beans.Documents.SearchName="documents.document_name";Beans.Documents.ListFields=["document_name","name","document_revision_id","filename","last_rev_mime_type"];Beans.Documents.TitleFields=["document_name"];Beans.Documents.TitleTpl="{document_name}";Beans.Documents.ViewDetailsFtrHook=function(b,a){displayCustom(b,"Documents",["filename"],a,false)};Beans.Notes=new SugarBean("Notes","notes");Beans.Notes.Predefined=["Edit"];Beans.Notes.HomeIcon=false;Beans.Notes.LastViewed=false;Beans.Notes.DefaultRelate={field:"contact_name",id_name:"contact_id",module:"Contacts"};Beans.Notes.DefaultParent={field:"parent_name",id_name:"parent_id",module:"parent_type"};Beans.Notes.ListFields=["name","filename","file_mime_type"];Beans.Notes.TmpFile={name:"",contents:""};SimpleBeans.Users=new SugarSimpleBean("Users","users","users.status='Active'","");if(!QCRM.OffLine){SimpleBeans.Users.Fields=["first_name","last_name"];SimpleBeans.Users.OrderBy="last_name";SimpleBeans.Users.ListFields=["first_name","last_name"];SimpleBeans.Users.ListViewTpl="{first_name} {last_name}";SimpleBeans.Users.link_fields='[{"name":"aclroles","value":["id","name"]}';if(typeof securitysuite!=="undefined"){if(securitysuite){SimpleBeans.Users.link_fields+=',{"name":"SecurityGroups","value":["id","name"]}'}}SimpleBeans.Users.link_fields+="]";SimpleBeans.Users.AfterLoad=function(h){var d,c,k=false,f=false,m,b=h.entry_list,g=b.length,e=[];for(d=0;d<g;d++){if(b[d].id===CurrentUserId){for(c=0;c<2;c++){m=h.relationship_list[d].link_list[c];if(m&&m.records&&m.records[0]){if(m.name==="aclroles"){k=m}else{if(m.name==="SecurityGroups"){f=m}}}}if(k){for(c=0;c<k.records.length;c++){e.push({id:k.records[c].link_value.id.value,name:k.records[c].link_value.name.value})}}if(f){CurrentProfileId=f.records[0].link_value.id.value;if(CurrentProfileId!==""&&CurrentProfileId!==null){localStorage.setItem(ServerAddress+"SugarTeamId",CurrentProfileId);QCRM.setProfile()}}break}}if(e.length>0){CurrentUserRoles=e;e=JSON.stringify(e)}else{e=""}localStorage.setItem(ServerAddress+"R"+CurrentUserId,e);if(typeof QuickCRMAfterLogin=="function"){QuickCRMAfterLogin()}}}JJWG={position:{lat:0,lng:0},unit:"km",gps_enabled:false,googlemaps:false,modules:["Accounts","Contacts","Leads"]};$("#JJWG").live("pagecreate",function(){var g,a=JJWG.modules,h="",l=JJWG.gps_enabled?"here":"",d={},b={here:RES_HERE};for(g in a){var k=a[g];if(Beans[k].Enabled()){if(h===""){h=k}if(l===""){l=k}d[k]=sugar_app_list_strings.moduleList[k]}}$("#map_type_title").text(RES_SEARCH_LABEL);$("#mapSearchBtn").text(sugar_app_strings.LBL_SEARCH_BUTTON_LABEL);$("#map_type").append(create_select("map_search_type",d,h,true));$("#map_dist_title").text(RES_DIST+" ("+JJWG.unit+")");$("#map_dist").append("<input id='map_search_dist' data-mini='true' type='number' value='50'/>");$("#map_from_title").text(RES_SEARCH_FROM);var j=$("<div class='ui-grid-a'/>"),f=$("<div id= 'map_from_type_div' class='ui-block-a'/>"),e=$("<div class='ui-block-b'/>");f.append(create_select("map_from_type",b,l,true));f.append('<div id="MapErr"/>');e.append('<input type="text" data-mini="true" id="map_from_name">');e.append('<input type="hidden" id="map_from_id"/><input type="hidden" id="map_from_adr"/><input type="hidden" id="map_from_lat"/><input type="hidden" id="map_from_lng"/><ul id="map_from_nameL" data-role="listview" data-inset="true" data-theme="c"/>');j.append(f);j.append(e);$("#map_from").append(j);$("#map_from_type").bind("change",function(c){$("#map_from_name").val("");$("#map_from_id").val("");$("#map_from_nameL").html("").listview("refresh");if($("#map_from_type").val()==="here"){}else{}});$("#map_from_name").on("input",function(){var p=$("#map_from_name").val();var o=$("#map_from_nameL");$("#map_from_id").val("");if(p.length<1||n==="here"){o.html("");o.listview("refresh")}else{var n=$("#map_from_type").val();var c=Beans[n];var m=c.table+"_cstm";var i=" "+Beans[n].SearchName+" LIKE '%"+p.replace("'","''")+"%' AND (("+m+".jjwg_maps_lat_c != 0 OR "+m+".jjwg_maps_lng_c != 0) AND ("+m+".jjwg_maps_geocode_status_c = 'OK'))";QCRM.get_entry_list(n,i,c.ListFieldsToSelect(),"",0,10,Beans[n].OrderBy,function(v){var r=v.entry_list,q=r.length;o.html("");for(var u=0;u<q;u++){var w=r[u].name_value_list,y=$('<li data-icon="false"/>'),x=$("<a/>",{href:"#"}),s=Beans[n].DisplayTitle(w);x.click({id:r[u].id,adr:w.jjwg_maps_address_c.value,lng:w.jjwg_maps_lng_c.value,lat:w.jjwg_maps_lat_c.value,name:s},function(t){$("#map_from_adr").val(t.data.adr);$("#map_from_lat").val(t.data.lat);$("#map_from_lng").val(t.data.lng);$("#map_from_id").val(t.data.id);$("#map_from_name").val(t.data.name.replace(/&#039;/g,"'"));o.html("");o.listview("refresh")});x.append(s);y.append(x);o.append(y)}o.listview("refresh")})}})});$("#JJWG").live("pageshow",function(){});JJWG.ShowMapSearch=function(){$("#mapsearchdiv").show();$.mobile.changePage("#JJWG")};JJWG.ShowMapBean=function(g,b,d,f){$("#mapsearchdiv").hide();$.mobile.changePage("#JJWG");var e=new google.maps.Map(document.getElementById("map_canvas"),{zoom:14,center:new google.maps.LatLng(g.lat,g.lng),zoomControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP}),c=new google.maps.InfoWindow,a=new google.maps.Marker({position:new google.maps.LatLng(g.lat,g.lng),map:e});google.maps.event.addListener(a,"click",(function(h,i){return function(){c.setContent(i);c.open(e,h)}})(a,b))};JJWG.AddMarker=function(g,c,d,f,e){$("#map_canvas").html();var b={position:new google.maps.LatLng(g.lat,g.lng),map:map};if(e){b.icon=JJWG.centermarker}var a=new google.maps.Marker(b);google.maps.event.addListener(a,"click",(function(h,i){return function(){infoWindow.setContent(i);infoWindow.open(map,h)}})(a,c))};JJWG.ShowBeansInMap=function(g,j,c,h,e,p,q,o){$("#map_canvas").html();var m,f,l,b,n=j.length,a=false,d=new google.maps.Map(document.getElementById("map_canvas"),{zoom:10,center:new google.maps.LatLng(c.lat,c.lng),zoomControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP}),k=new google.maps.InfoWindow;for(m=0;m<n;m++){f=j[m].name_value_list;b={position:new google.maps.LatLng(f.jjwg_maps_lat_c.value,f.jjwg_maps_lng_c.value),map:d};if(j[m].id===h){a=true;b.icon=JJWG.centermarker}l=new google.maps.Marker(b);google.maps.event.addListener(l,"click",(function(i,r){return function(){var s=(typeof o==="undefined")?Beans[g].DisplayTitle(r):o(r);s='<a href="#'+g+'DetailsPage" onclick="Beans[\''+g+"'].CurrentId='"+r.id.value+"';\">"+s+"</a><br>"+r.jjwg_maps_address_c.value;k.setContent(s);k.open(d,i)}})(l,f))}if(h!==""&&!a){l=new google.maps.Marker({position:new google.maps.LatLng(c.lat,c.lng),map:d,icon:JJWG.centermarker});google.maps.event.addListener(l,"click",(function(i){return function(){k.setContent('<a href="#'+e+'DetailsPage" onclick="Beans[\''+e+"'].CurrentId='"+h+"';\">"+p+"</a><br>"+q);k.open(d,i)}})(l))}};JJWG.distance=function(q,o,p){var e=3.1459/180;var h=6371,g=parseFloat(q.lat),f=parseFloat(o.lat),j=parseFloat(q.lng),i=parseFloat(o.lng),l=(f-g)*e,b=(i-j)*e,n=Math.sin(l/2)*Math.sin(l/2)+Math.cos(g*e)*Math.cos(f*e)*Math.sin(b/2)*Math.sin(b/2),m=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),k=h*m;if(p==="miles"){k=k*0.621371192}return k};JJWG.get_where=function(d,f,h){if(f!==""){var e=Beans[d].table+"_cstm",a,g,b,c="(("+e+".jjwg_maps_lat_c != 0 OR "+e+".jjwg_maps_lng_c != 0)  AND ("+e+".jjwg_maps_geocode_status_c = 'OK') AND ";if(true){a="(69.1 * ABS("+e+".jjwg_maps_lat_c -("+h.lat+")))";g="(53.0 * ABS("+e+".jjwg_maps_lng_c -("+h.lng+")))";b="( "+a+" + "+g+")";f="( 2 * "+f+")"}else{a="(69.1 * ("+e+".jjwg_maps_lat_c -("+h.lat+")))";g="(53.0 * ("+e+".jjwg_maps_lng_c -("+h.lng+")) * COS(("+h.lat+")/57.1))";b="SQRT( "+a+" * "+a+" + "+g+" * "+g+")"}if(JJWG.unit=="km"){b+=" * 1.609"}c+="("+b+" < "+f+"))";return c}else{return""}};JJWG.SearchMap=function(){var d=$("#map_search_type").val(),e=$("#map_search_dist").val(),a,b,c;$("#MapErr").html("");if(e!==""){if($("#map_from_type").val()==="here"){if(!JJWG.gps_enabled){$("#MapErr").html("<em>Position not available</em>");return}a=JJWG.position;b="";c=""}else{b=$("#map_from_id").val();if(b===""){return}c=$("#map_from_type").val();a={lat:$("#map_from_lat").val(),lng:$("#map_from_lng").val()}}QCRM.get_entry_list(d,JJWG.get_where(d,e,a),Beans[d].ListFieldsToSelect(),"",0,150,"",function(m){if(m){var g=m.entry_list,l=[],k,h=0,f=g.length,o=parseFloat(e);for(k=0;k<f;k++){var n=g[k].name_value_list;if(JJWG.distance({lat:n.jjwg_maps_lat_c.value,lng:n.jjwg_maps_lng_c.value},a,JJWG.unit)<o){l[h]=g[k];h++}}g=l;JJWG.ShowBeansInMap(d,g,a,b,c,$("#map_from_name").val(),$("#map_from_adr").val())}})}};JJWG.jjwgInitModule=function(a){Beans[a].ListFields=Beans[a].ListFields.concat(["jjwg_maps_lat_c","jjwg_maps_lng_c","jjwg_maps_address_c","jjwg_maps_geocode_status_c"])};JJWG.jjwg_updatemodules=function(d){if(d!==""){var c,b,e=[],a=d.split(", ");for(c in a){b=a[c];if(Beans[b]){e.push(b)}}JJWG.modules=e}};JJWG.jjwg_init=function(){var b,a,c=[];for(b in JJWG.modules){a=JJWG.modules[b];if(Beans[a]&&Beans[a].Enabled()){c.push(a);JJWG.jjwgInitModule(a)}}JJWG.modules=c};JJWG.onPositionUpdate=function(a){JJWG.position.lat=a.coords.latitude;JJWG.position.lng=a.coords.longitude;JJWG.gps_enabled=true};JJWG.jjwg_load=function(){function a(c){}JJWG.gps_enabled=false;try{if(navigator.geolocation){setTimeout(function(){navigator.geolocation.getCurrentPosition(JJWG.onPositionUpdate,a)},10)}if(google){google.load("maps","3",{other_params:"sensor=false",callback:function(){enableButton("MapsLinkLabel",true);JJWG.googlemaps=true;JJWG.centermarker=new google.maps.MarkerImage("images/marker_0.png",new google.maps.Size(20,34),new google.maps.Point(0,0),new google.maps.Point(10,34))}})}}catch(b){}};